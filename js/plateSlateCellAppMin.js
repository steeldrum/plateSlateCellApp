var portions=new Array();var plates=new Array();var slates=new Array();var slateOffsetThreshold=100;var isPlateMasterDataInserted=0;var plateSelectionsHtml;var plateGrainsHtml;var plateProteinHtml;var plateVegetablesHtml;var plateFruitsHtml;var plateDairyHtml;var selectedBreakfastPlate;var selectedLunchPlate;var selectedDinnerPlate;var plateSelectionRandom=true;var plateSelectionSeasonal=true;var plateSelectionShared=false;var plateSelectionReport='slate';var slateMealPlansForDinnerOnly=false;var preferences={plateSelectionRandom:true,plateSelectionSeasonal:true,plateSelectionShared:false,slateMealPlansForDinnerOnly:false};var loginInfo={id:0,userName:'unknown',firstName:'firstName',lastName:'lastName'};var weekday=new Array(7);weekday[0]="Sunday";weekday[1]="Monday";weekday[2]="Tuesday";weekday[3]="Wednesday";weekday[4]="Thursday";weekday[5]="Friday";weekday[6]="Saturday";var screenReportFontColors=new Array(10);screenReportFontColors[0]=0;screenReportFontColors[1]=20;screenReportFontColors[2]=40;screenReportFontColors[3]=60;screenReportFontColors[4]=80;screenReportFontColors[5]=100;screenReportFontColors[6]=120;screenReportFontColors[7]=140;screenReportFontColors[8]=160;screenReportFontColors[9]=180;var systemDB;function Portion(id,type,name,description,master,isInactive){this.id=id;this.type=type;this.name=name;this.description=description;this.master=master;this.isInactive=isInactive}function Plate(id,type,name,description,master,portion1,portion2,portion3,portion4,portion5,portion6,portion7,portion8,portion9,isInactive){this.id=id;this.type=type;this.name=name;this.description=description;this.master=master;this.portion1=portion1;this.portion2=portion2;this.portion3=portion3;this.portion4=portion4;this.portion5=portion5;this.portion6=portion6;this.portion7=portion7;this.portion8=portion8;this.portion9=portion9;this.isInactive=isInactive}function Slate(id,offset,date,name,description,breakfastId,lunchId,dinnerId,breakfastPortions,lunchPortions,dinnerPortions,isInactive){this.id=id;this.offset=offset;this.date=date;this.time=Date.parse(date);this.name=name;this.description=description;this.breakfastId=breakfastId;this.lunchId=lunchId;this.dinnerId=dinnerId;if(breakfastPortions!=null)this.breakfastPortions=breakfastPortions;else this.breakfastPortions=new Array();if(lunchPortions!=null)this.lunchPortions=lunchPortions;else this.lunchPortions=new Array();if(dinnerPortions!=null)this.dinnerPortions=dinnerPortions;else this.dinnerPortions=new Array();this.isInactive=isInactive}function initDB(){try{if(!window.openDatabase){alert('not supported')}else{var datab;var shortName='plateSlate';var version='1.0';var displayName='plateSlate';var maxSize=200000;datab=openDatabase(shortName,version,displayName,maxSize)}}catch(e){if(e==INVALID_STATE_ERR){alert("Invalid database version.")}else{alert("Unknown error "+e+".")}return}createTables(datab);systemDB=datab}function createTables(db){if(0){db.transaction(function(transaction){transaction.executeSql('DROP TABLE portion;');transaction.executeSql('DROP TABLE plate;');transaction.executeSql('DROP TABLE slate;');transaction.executeSql('DROP TABLE food;')})}db.transaction(function(transaction){transaction.executeSql('CREATE TABLE  IF NOT EXISTS portion '+' (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, '+' type varchar(16), name varchar(32),  description varchar(100), master integer, isInactive integer );');transaction.executeSql('CREATE TABLE  IF NOT EXISTS plate '+' (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, '+' type varchar(16), name varchar(32),  description varchar(100), master integer, portion1 integer, portion2 integer, portion3 integer, portion4 integer, portion5 integer, portion6 integer, portion7 integer, portion8 integer, portion9 integer, isInactive integer );');transaction.executeSql('CREATE TABLE  IF NOT EXISTS slate '+' (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, '+' date varchar(16), name varchar(32),  description varchar(100), breakfast integer, lunch integer, dinner integer, isInactive integer );');transaction.executeSql('CREATE TABLE  IF NOT EXISTS food '+' (id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, '+' slate integer, type varchar(16), portion integer, master integer, isInactive integer);')})}function readPortions(){initDB();loadPreferences();loadPortions()}function loadPortions(){var isPortionMasterDataInserted=false;var id;var type;var name;var description;var master;var isInactive;systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, type, name,  description, master, isInactive FROM portion',null,function(transaction,result){if(result.rows.length<=0){isPortionMasterDataInserted=false;populatePortion()}else{for(var i=0;i<result.rows.length;i++){var row=result.rows.item(i);id=parseInt(row.id);type=row.type;name=row.name;description=row.description;master=parseInt(row.master);isInactive=parseInt(row.isInactive);var portion=new Portion(id,type,name,description,master,isInactive);portions[id]=portion}isPortionMasterDataInserted=true;loadPlates()}},displayerrormessage)})}function populatePortion(){populatePortionMasterData()}function populatePortionMasterData(){var i=1;var portly;if(portions.length>0){portions.length=0;if(plates.length>0){plates.length=0}if(slates.length>0){slates.length=0}}portly=new Portion(i,"Grain","Bagels","Bagels",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","Bran Flakes","Bran Flakes",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","English Muffins","English Muffins",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","Irish Bread","Irish Bread",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","Muffins","Muffins",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","Pancakes","Pancakes",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","Pasta","Pasta",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","Pecan Buns","Pecan Buns",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","Puffs","Puffs",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","Rice","Rice",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","Schredded Wheat","Schredded Wheat",1,0);portions.push(portly);i++;portly=new Portion(i,"Grain","Toast","Toast",1,0);portions.push(portly);i++;portly=new Portion(i,"Protein","Bean Products","(Baked, Green, Lima)",1,0);portions.push(portly);i++;portly=new Portion(i,"Protein","Beef Products","(Ground, Roast)",1,0);portions.push(portly);i++;portly=new Portion(i,"Protein","Eggs","Eggs",1,0);portions.push(portly);i++;portly=new Portion(i,"Protein","Fish","Fish",1,0);portions.push(portly);i++;portly=new Portion(i,"Protein","Legeume Products","(Whole Peanuts, Green, Peanut Butter)",1,0);portions.push(portly);i++;portly=new Portion(i,"Protein","Poultry","(Chicken, Turkey)",1,0);portions.push(portly);i++;portly=new Portion(i,"Protein","Pork Products","(Bacon, Ham, Chops)",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Asparagas","Asparagas",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Beets","Beets",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Brussel Sprouts","Brussel Sprouts",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Cauliflour","Cauliflour",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Celery","Celery",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Corn","Corn",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Cucomber","(Cukes, Pickles, Zukini)",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Leafy Produce","Leafy Produce",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Onions","Onions",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Peas","Peas",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Peppers","Peppers",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Potatos","Potatos",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Squash","Squash",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Radishes","Radishes",1,0);portions.push(portly);i++;portly=new Portion(i,"Vegetables","Tomatoes","Tomatoes",1,0);portions.push(portly);i++;portly=new Portion(i,"Fruits","Apples","Apples",1,0);portions.push(portly);i++;portly=new Portion(i,"Fruits","Apricots","Apricots",1,0);portions.push(portly);i++;portly=new Portion(i,"Fruits","Bananas","Bananas",1,0);portions.push(portly);i++;portly=new Portion(i,"Fruits","Berries","Berries",1,0);portions.push(portly);i++;portly=new Portion(i,"Fruits","Cherries","Cherries",1,0);portions.push(portly);i++;portly=new Portion(i,"Fruits","Citrous","(Grapefruit, Oranges)",1,0);portions.push(portly);i++;portly=new Portion(i,"Fruits","Grapes","(Whole, Raisons)",1,0);portions.push(portly);i++;portly=new Portion(i,"Fruits","Peaches","(Whole, Necturines)",1,0);portions.push(portly);i++;portly=new Portion(i,"Fruits","Pears","Pears",1,0);portions.push(portly);i++;portly=new Portion(i,"Fruits","Plums","Plums",1,0);portions.push(portly);i++;portly=new Portion(i,"Dairy","Cheese","Cheese",1,0);portions.push(portly);i++;portly=new Portion(i,"Dairy","Ice Cream","Ice Cream",1,0);portions.push(portly);i++;portly=new Portion(i,"Dairy","Milk","Milk",1,0);portions.push(portly);i++;portly=new Portion(i,"Dairy","Yogurt","Yogurt",1,0);portions.push(portly);insertPortionMasterData()}function insertPortionMasterData(){var len=portions.length;var i=0;while(i<len){var portion=portions[i++];addToPortion(portion)}portions.length=0;loadPortions()}function addToPortion(portion){systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, type, name,  description, master, isInactive FROM portion where name=?;',[portion.name],function(transaction,result){if(result.rows.length>0){var row=result.rows.item(0);systemDB.transaction(function(transaction){transaction.executeSql('update portion set description=? where name=?;',[portion.description,portion.name],function(){},displayerrormessage)})}else{systemDB.transaction(function(transaction){transaction.executeSql('INSERT INTO portion (type, name,  description, master, isInactive) VALUES (?,?,?,?,?);',[portion.type,portion.name,portion.description,portion.master,portion.isInactive],function(){},displayerrormessage)})}})})}function getPortionByName(name){var len=portions.length;for(var i=0;i<len;i++){var portion=portions[i];if(portion!=null&&name==portion.name){return portion}}portion=new Portion(0,'unknown','unknown','unknown',0,1);return portion}function loadPlates(){var isPlateMasterDataInserted=false;var id;var type;var name;var description;var master;var portion1;var portion2;var portion3;var portion4;var portion5;var portion6;var portion7;var portion8;var portion9;var isInactive;systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, type, name,  description, master, portion1, portion2, portion3, portion4, portion5, portion6, portion7, portion8, portion9, isInactive FROM plate',null,function(transaction,result){if(result.rows.length<=0){isPlateMasterDataInserted=false;populatePlate()}else{for(var i=0;i<result.rows.length;i++){var row=result.rows.item(i);id=parseInt(row.id);type=row.type;name=row.name;description=row.description;master=parseInt(row.master);portion1=parseInt(row.portion1);portion2=parseInt(row.portion2);portion3=parseInt(row.portion3);portion4=parseInt(row.portion4);portion5=parseInt(row.portion5);portion6=parseInt(row.portion6);portion7=parseInt(row.portion7);portion8=parseInt(row.portion8);portion9=parseInt(row.portion9);isInactive=parseInt(row.isInactive);var plate=new Plate(id,type,name,description,master,portion1,portion2,portion3,portion4,portion5,portion6,portion7,portion8,portion9,isInactive);plates[id]=plate}isPlateMasterDataInserted=true;truncateSlates()}},displayerrormessage)})}function populatePlate(){populatePlateMasterData()}function populatePlateMasterData(){var i=1;var dish;var portion1;var portion2;var portion3;var portion4;var portion5;var portion6;var portion7;var portion8;var portion9;if(plates.length>0){plates.length=0}portion1=getPortionByName('Schredded Wheat');portion2=getPortionByName('Bananas');portion3=getPortionByName('Milk');portion4=getPortionByName('Muffins');dish=new Plate(i,"Breakfast","Schred-n-Bread","Cereal, Fruit, etc.",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Bran Flakes');portion2=getPortionByName('Grapes');portion3=getPortionByName('Milk');portion4=getPortionByName('Muffins');dish=new Plate(i,"Breakfast","Flakes-n-Bakes","Cereal, Fruit, etc.",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Puffs');portion2=getPortionByName('Berries');portion3=getPortionByName('Milk');portion4=getPortionByName('Muffins');dish=new Plate(i,"Breakfast","Puffs-n-Stuff","Cereal, Fruit, etc.",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Eggs');portion2=getPortionByName('Toast');dish=new Plate(i,"Breakfast","Eggs","Eggs",1,portion1.id,portion2.id,null,null,null,null,null,null,null,0);plates.push(dish);i++;dish=new Plate(i,"Breakfast","Sleep-Late","No Breakfast!",1,null,null,null,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Leafy Produce');portion2=getPortionByName('Cucomber');portion3=getPortionByName('Onions');portion4=getPortionByName('Radishes');portion5=getPortionByName('Tomatoes');portion6=getPortionByName('Eggs');dish=new Plate(i,"Lunch","Chef Salad","(with hard cooked egg)",1,portion1.id,portion2.id,portion3.id,portion4.id,portion5.id,portion6.id,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Irish Bread');portion2=getPortionByName('Pork Products');portion3=getPortionByName('Cheese');portion4=getPortionByName('Apples');dish=new Plate(i,"Lunch","Ham Sandwich","(with fruit)",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Irish Bread');portion2=getPortionByName('Pork Products');portion3=getPortionByName('Cheese');portion4=getPortionByName('Apples');dish=new Plate(i,"Lunch","Grilled Cheese","(with fruit)",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Irish Bread');portion2=getPortionByName('Legeume Products');portion3=getPortionByName('Berries');portion4=getPortionByName('Apples');dish=new Plate(i,"Lunch","PB Sandwich","(with fruit)",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pasta');portion2=getPortionByName('Tomatoes');portion3=getPortionByName('Toast');portion4=getPortionByName('Apples');dish=new Plate(i,"Lunch","Soup-n-Crackers","(with fruit)",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Irish Bread');portion2=getPortionByName('Fish');portion3=getPortionByName('Celery');portion4=getPortionByName('Cucomber');portion5=getPortionByName('Apples');dish=new Plate(i,"Lunch","TunaFish-n-Pita","(with fruit)",1,portion1.id,portion2.id,portion3.id,portion4.id,portion5.id,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Irish Bread');portion2=getPortionByName('Poultry');portion3=getPortionByName('Leafy Produce');portion4=getPortionByName('Apples');dish=new Plate(i,"Lunch","Turkey Sandwich","(with fruit)",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;dish=new Plate(i,"Lunch","Skip-Lunch","Too Busy!",1,null,null,null,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pasta');portion2=getPortionByName('Beef Products');portion3=getPortionByName('Onions');portion4=getPortionByName('Tomatoes');dish=new Plate(i,"Dinner","American Chop Suey","",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Beef Products');portion2=getPortionByName('Potatos');portion3=getPortionByName('Squash');dish=new Plate(i,"Dinner","BeefRoast-w-PotVeg","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Beef Products');portion2=getPortionByName('Potatos');portion3=getPortionByName('Onions');portion4=getPortionByName('Squash');dish=new Plate(i,"Dinner","Beef Stew","",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Poultry');portion2=getPortionByName('Rice');portion3=getPortionByName('Squash');dish=new Plate(i,"Dinner","BakeChic-w-RiceVeg","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Poultry');portion2=getPortionByName('Rice');portion3=getPortionByName('Squash');dish=new Plate(i,"Dinner","GrillChic-w-RiceVeg","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Poultry');portion2=getPortionByName('Rice');portion3=getPortionByName('Cheese');portion4=getPortionByName('Squash');dish=new Plate(i,"Dinner","ChicParm-w-RiceVeg","",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Poultry');portion2=getPortionByName('Potatos');portion3=getPortionByName('Onions');portion4=getPortionByName('Squash');dish=new Plate(i,"Dinner","ChicPotPie","",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Poultry');portion2=getPortionByName('Rice');portion3=getPortionByName('Squash');dish=new Plate(i,"Dinner","ChicRotiss-w-RiceVeg","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Corn');portion2=getPortionByName('Milk');portion3=getPortionByName('Potatos');dish=new Plate(i,"Dinner","Corn Chowder","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Fish');portion2=getPortionByName('Rice');portion3=getPortionByName('Asparagas');dish=new Plate(i,"Dinner","Haddock-w-RiceVeg","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Beef Products');portion2=getPortionByName('Leafy Produce');portion3=getPortionByName('Cucomber');portion4=getPortionByName('Radishes');portion5=getPortionByName('Tomatoes');dish=new Plate(i,"Dinner","Hamburg-w-Salad","",1,portion1.id,portion2.id,portion3.id,portion4.id,portion5.id,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pork Products');portion2=getPortionByName('Rice');portion3=getPortionByName('Brussel Sprouts');dish=new Plate(i,"Dinner","Ham Steak-w-RiceVeg","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Beef Products');portion2=getPortionByName('Bean Products');portion3=getPortionByName('Muffins');dish=new Plate(i,"Dinner","HotDog-w-Beans","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pasta');portion2=getPortionByName('Beef Products');portion3=getPortionByName('Tomatoes');dish=new Plate(i,"Dinner","ItalianLasagna","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pasta');portion2=getPortionByName('Cheese');portion3=getPortionByName('Beef Products');dish=new Plate(i,"Dinner","Mac-n-Cheese-w-HotDog","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Beef Products');portion2=getPortionByName('Eggs');portion3=getPortionByName('Irish Bread');portion4=getPortionByName('Potatos');portion5=getPortionByName('Brussel Sprouts');dish=new Plate(i,"Dinner","Meatloaf-w-PotVeg","",1,portion1.id,portion2.id,portion3.id,portion4.id,portion5.id,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pork Products');portion2=getPortionByName('Peas');dish=new Plate(i,"Dinner","Pea Soup-w-Ham","",1,portion1.id,portion2.id,null,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pork Products');portion2=getPortionByName('Potatos');portion3=getPortionByName('Brussel Sprouts');dish=new Plate(i,"Dinner","Pork Chops-w-PotVeg","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pasta');portion2=getPortionByName('Beef Products');portion3=getPortionByName('Eggs');portion4=getPortionByName('Tomatoes');dish=new Plate(i,"Dinner","ItalianRavioli","",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pork Products');portion2=getPortionByName('Eggs');portion3=getPortionByName('Toast');dish=new Plate(i,"Dinner","Salami-n-Eggs-w-Toast","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pork Products');portion2=getPortionByName('Peppers');portion3=getPortionByName('Onions');dish=new Plate(i,"Dinner","Sausage-w-Pepper-n-Onion","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Beef Products');portion2=getPortionByName('Potatos');portion3=getPortionByName('Corn');dish=new Plate(i,"Dinner","Shepards Pie","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pasta');portion2=getPortionByName('Beef Products');portion3=getPortionByName('Eggs');portion4=getPortionByName('Tomatoes');dish=new Plate(i,"Dinner","ItalianSpaghetti","",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Beef Products');portion2=getPortionByName('Potatos');portion3=getPortionByName('Squash');dish=new Plate(i,"Dinner","Steak-w-PotVeg","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Beef Products');portion2=getPortionByName('Rice');portion3=getPortionByName('Onions');portion4=getPortionByName('Peppers');dish=new Plate(i,"Dinner","Stuffed Peppers","",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Beef Products');portion2=getPortionByName('Potatos');portion3=getPortionByName('Eggs');portion4=getPortionByName('Squash');dish=new Plate(i,"Dinner","SwedishMBalls-w-MashPotVeg","",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Poultry');portion2=getPortionByName('Leafy Produce');portion3=getPortionByName('Cheese');portion4=getPortionByName('Corn');dish=new Plate(i,"Dinner","Tacos","",1,portion1.id,portion2.id,portion3.id,portion4.id,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Pasta');portion2=getPortionByName('Fish');dish=new Plate(i,"Dinner","Tuna Noodle Caserole","",1,portion1.id,portion2.id,null,null,null,null,null,null,null,0);plates.push(dish);i++;portion1=getPortionByName('Poultry');portion2=getPortionByName('Potatos');portion3=getPortionByName('Corn');dish=new Plate(i,"Dinner","Turkey-w-PotVeg","",1,portion1.id,portion2.id,portion3.id,null,null,null,null,null,null,0);plates.push(dish);i++;dish=new Plate(i,"Dinner","Eat-Out","Potpourri!",1,null,null,null,null,null,null,null,null,null,0);plates.push(dish);i++;insertPlateMasterData()}function insertPlateMasterData(){var len=plates.length;var i=0;while(i<len){var plate=plates[i++];addToPlate(plate)}loadPlates()}function addToPlate(plate){systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, type, name,  description, master, portion1, portion2, portion3, portion4, portion5, portion6, portion7, portion8, portion9, isInactive FROM plate where name=?;',[plate.name],function(transaction,result){if(result.rows.length>0){var row=result.rows.item(0);systemDB.transaction(function(transaction){transaction.executeSql('update plate set description=?, portion1=?, portion2=?, portion3=?, portion4=?, portion5=?, portion6=?, portion7=?, portion8=?, portion9=? where name=?;',[plate.description,plate.portion1,plate.portion2,plate.portion3,plate.portion4,plate.portion5,plate.portion6,plate.portion7,plate.portion8,plate.portion9,plate.name],function(){},displayerrormessage)})}else{systemDB.transaction(function(transaction){transaction.executeSql('INSERT INTO plate (type, name,  description, master, portion1, portion2, portion3, portion4, portion5, portion6, portion7, portion8, portion9, isInactive) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?);',[plate.type,plate.name,plate.description,plate.master,plate.portion1,plate.portion2,plate.portion3,plate.portion4,plate.portion5,plate.portion6,plate.portion7,plate.portion8,plate.portion9,plate.isInactive],function(){},displayerrormessage)})}})})}function truncateSlates(){var maximumSlateCount=28;systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, date, name, isInactive FROM slate order by id',null,function(transaction,result){if(result.rows.length>0){resultsLen=result.rows.length;if(resultsLen>maximumSlateCount){var truncateCount=resultsLen-maximumSlateCount;var slateIds=new Array();var lastDateName;for(var i=0;i<truncateCount;i++){var row=result.rows.item(i);id=parseInt(row.id);date=row.date;name=row.name;lastDateName=name;slateIds.push(id)}var len=slateIds.length;for(var i=0;i<len;i++){deleteSlatesFoodsBeforeDate(slateIds[i]);var torf=false;if(i==len-1){torf=true}deleteSlatesBeforeDate(slateIds[i],torf)}}else{loadSlates()}}else{loadSlates()}})})}function deleteSlatesFoodsBeforeDate(id){systemDB.transaction(function(transaction){transaction.executeSql('DELETE from food where slate = ?',[id],function(transaction,result){})})}function deleteSlatesBeforeDate(id,torf){systemDB.transaction(function(transaction){transaction.executeSql('DELETE from slate where id = ?',[id],function(transaction,result){if(torf){loadSlates()}})})}function loadSlates(){var today=new Date();today.setHours(0,0,0,0);var todayName=today.toLocaleDateString();var weekdayName=weekday[today.getDay()];var isSlateDataInserted=false;var id;var offset=slateOffsetThreshold;var date;var name;var description;var breakfastId;var lunchId;var dinnerId;var isInactive;var slate;var currentSlate;var breakfastPlate;var lunchPlate;var dinnerPlate;var markIndex=-1;var index=0;var tempSlates=new Array();var tempSlatesLen=0;var resultsLen=0;var tempSlate;var lastSlateName=null;if(slates.length>0){for(var i=0;i<slates.length;i++){if(typeof(slates[i]!=='undefined')){destroySlate(slates[i])}}slates.length=0}systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, date, name,  description, breakfast, lunch, dinner, isInactive FROM slate',null,function(transaction,result){if(result.rows.length>0){resultsLen=result.rows.length;for(var i=0;i<result.rows.length;i++){var row=result.rows.item(i);id=parseInt(row.id);date=row.date;name=row.name;description=row.description;breakfastId=parseInt(row.breakfast);lunchId=parseInt(row.lunch);dinnerId=parseInt(row.dinner);isInactive=parseInt(row.isInactive);tempSlates[index++]=new Slate(id,0,date,name,description,breakfastId,lunchId,dinnerId,null,null,null,isInactive);var tempIndex=index-1}tempSlates.sort(compareTimes);for(var i=0;i<tempSlates.length;i++){slate=tempSlates[i];name=slate.name;if(name==todayName){markIndex=i}}tempSlatesLen=tempSlates.length;if(markIndex>=0){lastSlateName=null;offset=slateOffsetThreshold;for(var i=markIndex;i>=0;i--){slate=copySlate(tempSlates[i]);destroySlate(tempSlates[i]);if(lastSlateName==null){lastSlateName=slate.name}else if(slate.name==lastSlateName){continue}else{lastSlateName=slate.name}if(i==markIndex){currentSlate=slate}slate.offset=offset;slates[offset]=slate;appendFood(loadSlatesCallback,0,100,slate);offset--}if(tempSlatesLen-1>markIndex){lastSlateName=null;offset=slateOffsetThreshold+1;for(var i=markIndex+1;i<tempSlatesLen;i++){slate=copySlate(tempSlates[i]);destroySlate(tempSlates[i]);if(lastSlateName==null){lastSlateName=slate.name}else if(slate.name==lastSlateName){continue}else{lastSlateName=slate.name}slate.offset=offset;slates[offset]=slate;appendFood(loadSlatesCallback,0,100,slate);offset++}}appendFood(loadSlatesCallback,0,1,currentSlate)}else{offset=slateOffsetThreshold;breakfastPlate=getRandomPlate("Breakfast",offset);lunchPlate=getRandomPlate("Lunch",offset);dinnerPlate=getRandomPlate("Dinner",offset);slate=new Slate(0,offset,today,today.toLocaleDateString(),weekdayName,breakfastPlate.id,lunchPlate.id,dinnerPlate.id,null,null,null,0);appendSlate(loadSlatesCallback,slate,offset);if(tempSlatesLen>0){lastSlateName=null;offset=slateOffsetThreshold-1;for(var i=tempSlatesLen-1;i>=0;i--){slate=copySlate(tempSlates[i]);destroySlate(tempSlates[i]);if(lastSlateName==null){lastSlateName=slate.name}else if(slate.name==lastSlateName){continue}else{lastSlateName=slate.name}slate.offset=offset;slates[offset]=slate;appendFood(loadSlatesCallback,0,100,slate);offset--}}}isSlateDataInserted=true}else{offset=slateOffsetThreshold;breakfastPlate=getRandomPlate("Breakfast",offset);lunchPlate=getRandomPlate("Lunch",offset);dinnerPlate=getRandomPlate("Dinner",offset);slate=new Slate(0,offset,today,today.toLocaleDateString(),weekdayName,breakfastPlate.id,lunchPlate.id,dinnerPlate.id,null,null,null,0);appendSlate(loadSlatesCallback,slate,offset)}},displayerrormessage)})}function loadSlatesCallback(torf){if(torf==true){populateSlate()}}function addToSlate(slate){var id=0;systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, date, name,  description, breakfast, lunch, dinner, isInactive FROM slate where name=?;',[slate.name],function(transaction,result){if(result.rows.length>0){var row=result.rows.item(0);id=parseInt(row.id);systemDB.transaction(function(transaction){transaction.executeSql('update slate set description=?, breakfast=?, lunch=?, dinner=? where name=?;',[slate.description,slate.breakfastId,slate.lunchId,slate.dinnerId,slate.name],function(){},displayerrormessage)});appendFood(loadSlatesCallback,0,1,slate)}else{systemDB.transaction(function(transaction){transaction.executeSql('INSERT INTO slate (date, name,  description, breakfast, lunch, dinner, isInactive) VALUES (?,?,?,?,?,?,?);',[slate.date,slate.name,slate.description,slate.breakfastId,slate.lunchId,slate.dinnerId,slate.isInactive],function(transaction,result){if(!result.rowsAffected){alert('plateslate addToSlate No rows affected!');return false}id=result.insertId;slate.id=id;appendFood(loadSlatesCallback,0,1,slate)})})}})})}function appendSlate(loadSlatesCallback,slate,offset){var id=0;systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, date, name,  description, breakfast, lunch, dinner, isInactive FROM slate where name=?;',[slate.name],function(transaction,result){if(result.rows.length>0){var row=result.rows.item(0);id=parseInt(row.id);systemDB.transaction(function(transaction){transaction.executeSql('update slate set description=?, breakfast=?, lunch=?, dinner=? where name=?;',[slate.description,slate.breakfastId,slate.lunchId,slate.dinnerId,slate.name],function(){},displayerrormessage)});appendFood(loadSlatesCallback,0,1,slate)}else{systemDB.transaction(function(transaction){transaction.executeSql('INSERT INTO slate (date, name,  description, breakfast, lunch, dinner, isInactive) VALUES (?,?,?,?,?,?,?);',[slate.date,slate.name,slate.description,slate.breakfastId,slate.lunchId,slate.dinnerId,slate.isInactive],function(transaction,result){if(!result.rowsAffected){alert('plateslate appendSlate No rows affected!');return false}id=result.insertId;slate.id=id;slates[offset]=slate;appendFood(loadSlatesCallback,0,1,slate)})})}})})}function displayerrormessage(transaction,error){alert('Error:  '+error.message+' has occurred with Code: '+error.code);return true}function getSlateView(offset,mealName){var plateStyle='style="font-family: Chalkduster, sans-serif; color: '+makeColor(color)+'; font-size: 150%; font-weight: bold;"';var thresholdOffset=offset+slateOffsetThreshold;var dow;if(thresholdOffset==slateOffsetThreshold)dow="Today";else if(thresholdOffset-slateOffsetThreshold==1)dow="Tomorrow";else if(thresholdOffset-slateOffsetThreshold==-1)dow="Prior Slate";else if(thresholdOffset-slateOffsetThreshold>0)dow=offset.toString()+" days from now";else dow=(Math.abs(offset)).toString()+" slates ago";var slate;var plateDescription;var html;var slateRandomlyGenerated=false;var plateType;if(slates.length==0){var nextDate=new Date();var nextDateWeekdayName=weekday[nextDate.getDay()];breakfastPlate=getRandomPlate("Breakfast",thresholdOffset);lunchPlate=getRandomPlate("Lunch",thresholdOffset);dinnerPlate=getRandomPlate("Dinner",thresholdOffset);slate=new Slate(0,thresholdOffset,nextDate,nextDate.toLocaleDateString(),nextDateWeekdayName,breakfastPlate.id,lunchPlate.id,dinnerPlate.id,null,null,null,0);slates[thresholdOffset]=slate;addToSlate(slate)}if(typeof(slates[thresholdOffset])==='undefined'){if(thresholdOffset-slateOffsetThreshold<0){var name='NO MORE PRIOR SLATES!';html='<ul data-role="listview" data-divider-theme="b">';html+='<li data-role="list-divider">';html+=dow+' <p class="ui-li-aside"><strong>'+name+'</strong></p></li>';html+='<li>No Meals Were Planned for this Day!</li>'}else{var priorOffset=offset-1;var nextDateMillis;if(slates.length>0){slate=slates[priorOffset+slateOffsetThreshold];var priorDate=slate.date;var priorDateName=priorDate.toLocaleString();priorDate=new Date(priorDateName);var priorDateMillis=priorDate.getTime();nextDateMillis=priorDateMillis+24*60*60*1000}else{nextDateMillis=0}var nextDate=new Date();if(nextDateMillis>0){nextDate.setTime(nextDateMillis)}nextDate.setHours(0,0,0,0);var nextDateWeekdayName=weekday[nextDate.getDay()];breakfastPlate=getRandomPlate("Breakfast",thresholdOffset);lunchPlate=getRandomPlate("Lunch",thresholdOffset);dinnerPlate=getRandomPlate("Dinner",thresholdOffset);var breakfastPortions=getPlatePortions(breakfastPlate);var lunchPortions=getPlatePortions(lunchPlate);var dinnerPortions=getPlatePortions(dinnerPlate);slate=new Slate(0,thresholdOffset,nextDate,nextDate.toLocaleDateString(),nextDateWeekdayName,breakfastPlate.id,lunchPlate.id,dinnerPlate.id,breakfastPortions,lunchPortions,dinnerPortions,0);slates[thresholdOffset]=slate;addToSlate(slate);slateRandomlyGenerated=true}}if(typeof(slates[thresholdOffset])!=='undefined'){slate=slates[thresholdOffset];var name=slate.name;html='<ul data-role="listview" data-divider-theme="b">';html+='<li data-role="list-divider">'+dow+' <p class="ui-li-aside"><strong>'+name+'</strong></p></li>';if(mealName=="Breakfast"){var plate=plates[slate.breakfastId];plateDescription=plate.description;if(plateDescription.length==0||plateDescription==null)plateDescription="starter choice!";plateSelectionsHtml=getPlateSelections(slate,plate,thresholdOffset,slateRandomlyGenerated);plateType="'Breakfast'"}else if(mealName=="Lunch"){plate=plates[slate.lunchId];plateDescription=plate.description;if(plateDescription.length==0||plateDescription==null)plateDescription="midday milestone!";plateSelectionsHtml=getPlateSelections(slate,plate,thresholdOffset,slateRandomlyGenerated);plateType="'Lunch'"}else if(mealName=="Dinner"){plate=plates[slate.dinnerId];plateDescription=plate.description;if(plateDescription.length==0||plateDescription==null)plateDescription="main entree!";plateSelectionsHtml=getPlateSelections(slate,plate,thresholdOffset,slateRandomlyGenerated);plateType="'Dinner'"}html+='<li data-role="list-divider">'+plateSelectionsHtml+' <p class="ui-li-aside"><span '+plateStyle+'>'+plateDescription+'</span></p></li>';var grainDeferred=plateGrainsHtml=='<li/>';var proteinDeferred=plateProteinHtml=='<li/>';var vegetablesDeferred=plateVegetablesHtml=='<li/>';var fruitsDeferred=plateFruitsHtml=='<li/>';var dairyDeferred=plateDairyHtml=='<li/>';if(!grainDeferred){html+=getGrainMealHtml(offset,mealName)}if(!proteinDeferred){html+=getProteinMealHtml(offset,mealName)}if(!vegetablesDeferred){html+=getVegetablesMealHtml(offset,mealName)}if(!fruitsDeferred){html+=getFruitsMealHtml(offset,mealName)}if(!dairyDeferred){html+=getDairyMealHtml(offset,mealName)}if(grainDeferred){html+=getGrainMealHtml(offset,mealName)}if(proteinDeferred){html+=getProteinMealHtml(offset,mealName)}if(vegetablesDeferred){html+=getVegetablesMealHtml(offset,mealName)}if(fruitsDeferred){html+=getFruitsMealHtml(offset,mealName)}if(dairyDeferred){html+=getDairyMealHtml(offset,mealName)}}html+='</ul>';return html}function getGrainMealHtml(offset,mealName){var newGrainHtml=getPortionSelections(offset,mealName,"Grain");var html='<li data-role="list-divider" data-theme="b">'+newGrainHtml+' <p class="ui-li-aside dividerIcon"><strong>+ Grain</strong></p></li>';html+=plateGrainsHtml;return html}function getProteinMealHtml(offset,mealName){var newProteinHtml=getPortionSelections(offset,mealName,"Protein");var html='<li data-role="list-divider" data-theme="b">'+newProteinHtml+' <p class="ui-li-aside dividerIcon"><strong>+ Protein</strong></p></li>';html+=plateProteinHtml;return html}function getVegetablesMealHtml(offset,mealName){var newVegetablesHtml=getPortionSelections(offset,mealName,"Vegetables");var html='<li data-role="list-divider" data-theme="b">'+newVegetablesHtml+' <p class="ui-li-aside dividerIcon"><strong>+ Vegetable</strong></p></li>';html+=plateVegetablesHtml;return html}function getFruitsMealHtml(offset,mealName){var newFruitsHtml=getPortionSelections(offset,mealName,"Fruits");var html='<li data-role="list-divider" data-theme="b">'+newFruitsHtml+' <p class="ui-li-aside dividerIcon"><strong>+ Fruit</strong></p></li>';html+=plateFruitsHtml;return html}function getDairyMealHtml(offset,mealName){var newDairyHtml=getPortionSelections(offset,mealName,"Dairy");var html='<li data-role="list-divider" data-theme="b">'+newDairyHtml+' <p class="ui-li-aside dividerIcon"><strong>+ Dairy</strong></p></li>';html+=plateDairyHtml;return html}function getRandomPlate(plateType,offset){var len=plates.length;var breakfastLen=0;var lunchLen=0;var dinnerLen=0;var typeLen=0;var plate;var selectedPlate=null;for(var i=0;i<len;i++){if(typeof(plates[i])==='undefined')continue;plate=plates[i];if(plate!=null){if(plate.type==plateType){typeLen++}}else{}}var html='<select id="'+plateType+'_'+offset+'"><optgroup label="'+plateType+'">';if(typeLen>0){var selectedOption=Math.floor(Math.random()*(typeLen-1));var offset=0;for(var i=0;i<len;i++){if(typeof(plates[i])==='undefined')continue;plate=plates[i];if(plate!=null){if(plate.type==plateType){html+='<option value ="'+plate.id+'"';if(offset==selectedOption){html+=' selected="selected" ';selectedPlate=plate}html+='>'+plate.name+'</option>';offset++}}}plateSelectionsHtml=html+'</optgroup></select>'}return selectedPlate}function getPlatePortions(plate){var typePortions=new Array();var portionId;for(var i=0;i<9;i++){switch(i){case 0:portionId=plate.portion1;if(portionId!=null&&portionId>0)typePortions.push(portionId);break;case 1:portionId=plate.portion2;if(portionId!=null&&portionId>0)typePortions.push(portionId);break;case 2:portionId=plate.portion3;if(portionId!=null&&portionId>0)typePortions.push(portionId);break;case 3:portionId=plate.portion4;if(portionId!=null&&portionId>0)typePortions.push(portionId);break;case 4:portionId=plate.portion5;if(portionId!=null&&portionId>0)typePortions.push(portionId);break;case 5:portionId=plate.portion6;if(portionId!=null&&portionId>0)typePortions.push(portionId);break;case 6:portionId=plate.portion7;if(portionId!=null&&portionId>0)typePortions.push(portionId);break;case 7:portionId=plate.portion8;if(portionId!=null&&portionId>0)typePortions.push(portionId);break;case 8:portionId=plate.portion9;if(portionId!=null&&portionId>0)typePortions.push(portionId);break;default:break}}return typePortions}function getPlateSelections(slate,plate,offset,slateRandomlyGenerated){var len=plates.length;var breakfastLen=0;var lunchLen=0;var dinnerLen=0;var typeLen=0;plateGrainsHtml='<li/>';plateProteinHtml='<li/>';plateVegetablesHtml='<li/>';plateFruitsHtml='<li/>';plateDairyHtml='<li/>';var currentPlate;var plateType=plate.type;var id=plate.id;var selectedPlate=null;for(var i=0;i<len;i++){if(typeof(plates[i])==='undefined')continue;currentPlate=plates[i];if(currentPlate!=null){if(currentPlate.type==plateType){typeLen++}}else{}}var html='<select class="'+plateType+'"><optgroup label="'+plateType+'">';if(typeLen>0){var offset=0;for(var i=0;i<len;i++){if(typeof(plates[i])==='undefined')continue;currentPlate=plates[i];if(currentPlate!=null){if(currentPlate.type==plateType){html+='<option value ="'+currentPlate.id+'"';if(id==currentPlate.id){html+=' selected="selected" '}html+='>'+currentPlate.name+'</option>';offset++}}}var plateSelectionsHtml=html+'</optgroup></select>';getFoodPortions(slate,plate)}return plateSelectionsHtml}function getTestPlateSelections(slate,plate,offset){var len=plates.length;var breakfastLen=0;var lunchLen=0;var dinnerLen=0;var typeLen=0;plateGrainsHtml='<li/>';plateProteinHtml='<li/>';plateVegetablesHtml='<li/>';plateFruitsHtml='<li/>';plateDairyHtml='<li/>';var currentPlate;var plateType=plate.type;var id=plate.id;var selectedPlate=null;for(var i=0;i<len;i++){if(typeof(plates[i])==='undefined')continue;currentPlate=plates[i];if(currentPlate!=null){if(currentPlate.type==plateType){typeLen++}}else{}}var html='<select id="'+plateType+'_'+offset+'"><optgroup label="'+plateType+'">';if(typeLen>0){var offset=0;for(var i=0;i<len;i++){if(typeof(plates[i])==='undefined')continue;currentPlate=plates[i];if(currentPlate!=null){if(currentPlate.type==plateType){html+='<option value ="'+currentPlate.id+'"';if(id==currentPlate.id){html+=' selected="selected" '}html+='>'+currentPlate.name+'</option>';offset++}}}var plateSelectionsHtml=html+'</optgroup></select>'}return plateSelectionsHtml}function getPortionSelections(offset,mealName,portionType){var thresholdOffset=offset+slateOffsetThreshold;var slate=slates[thresholdOffset];var foodPortions;if(mealName=="Breakfast"){foodPortions=slate.breakfastPortions}else if(mealName=="Lunch"){foodPortions=slate.lunchPortions}else if(mealName=="Dinner"){foodPortions=slate.dinnerPortions}portionSelectionsHtml='<select name="portionSelection" class="'+portionType+'" onchange="javascript:processAddNewPortion('+offset+', '+"'"+mealName+"'"+', '+"'"+portionType+"', "+'this.options[this.selectedIndex].value);"><optgroup label="'+portionType+'">';var len=portions.length;if(len>0){for(var i=0;i<len;i++){var currentPortion=portions[i];if(currentPortion!=null){if(currentPortion.type==portionType){if(!isPortionSelected(currentPortion.id,foodPortions)){portionSelectionsHtml+='<option value ="'+currentPortion.id+'">'+currentPortion.name+'</option>'}}}}portionSelectionsHtml+='</optgroup></select>'}return portionSelectionsHtml}function isPortionSelected(portionId,foodPortions){var torf=false;for(var i=0;i<foodPortions.length;i++){if(portionId==foodPortions[i]){torf=true;break}}return torf}function appendPortion(plate,portionId,plateIndex,slateTorf){var chalkColor=0;if(slateTorf){chalkColor=makeColor(color)}if(!isNaN(portionId)){if(portionId==0)return;var portion=portions[portionId];var type=portion.type;if(type=='Grain'){if(plateGrainsHtml=='<li/>'){plateGrainsHtml='<li class="grainPortion"><a href="javascript:dropPortion('+plateIndex+", '"+plate.type+"', "+portionId+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk"';if(slateTorf){plateGrainsHtml+=' style="color:'+chalkColor+'"'}plateGrainsHtml+='>'+portion.name+'</span></a></li>'}else{plateGrainsHtml+='<li class="grainPortion"><a href="javascript:dropPortion('+plateIndex+", '"+plate.type+"', "+portionId+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk"';if(slateTorf){plateGrainsHtml+=' style="color:'+chalkColor+'"'}plateGrainsHtml+='>'+portion.name+'</span></a></li>'}}else if(type=='Protein'){if(plateProteinHtml=='<li/>'){plateProteinHtml='<li class="proteinPortion"><a href="javascript:dropPortion('+plateIndex+", '"+plate.type+"', "+portionId+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk"';if(slateTorf){plateProteinHtml+=' style="color:'+chalkColor+'"'}plateProteinHtml+='>'+portion.name+'</span></a></li>'}else{plateProteinHtml+='<li class="proteinPortion"><a href="javascript:dropPortion('+plateIndex+", '"+plate.type+"', "+portionId+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk"';if(slateTorf){plateProteinHtml+=' style="color:'+chalkColor+'"'}plateProteinHtml+='>'+portion.name+'</span></a></li>'}}else if(type=='Vegetables'){if(plateVegetablesHtml=='<li/>'){plateVegetablesHtml='<li class="vegetablesPortion"><a href="javascript:dropPortion('+plateIndex+", '"+plate.type+"', "+portionId+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk"';if(slateTorf){plateVegetablesHtml+=' style="color:'+chalkColor+'"'}plateVegetablesHtml+='>'+portion.name+'</span></a></li>'}else{plateVegetablesHtml+='<li class="vegetablesPortion"><a href="javascript:dropPortion('+plateIndex+", '"+plate.type+"', "+portionId+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk"';if(slateTorf){plateVegetablesHtml+=' style="color:'+chalkColor+'"'}plateVegetablesHtml+='>'+portion.name+'</span></a></li>'}}else if(type=='Fruits'){if(plateFruitsHtml=='<li/>'){plateFruitsHtml='<li class="fruitsPortion"><a href="javascript:dropPortion('+plateIndex+", '"+plate.type+"', "+portionId+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk"';if(slateTorf){plateFruitsHtml+=' style="color:'+chalkColor+'"'}plateFruitsHtml+='>'+portion.name+'</span></a></li>'}else{plateFruitsHtml+='<li class="fruitsPortion"><a href="javascript:dropPortion('+plateIndex+", '"+plate.type+"', "+portionId+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk"';if(slateTorf){plateFruitsHtml+=' style="color:'+chalkColor+'"'}plateFruitsHtml+='>'+portion.name+'</span></a></li>'}}else if(type=='Dairy'){if(plateDairyHtml=='<li/>'){plateDairyHtml='<li class="dairyPortion"><a href="javascript:dropPortion('+plateIndex+", '"+plate.type+"', "+portionId+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk"';if(slateTorf){plateDairyHtml+=' style="color:'+chalkColor+'"'}plateDairyHtml+='>'+portion.name+'</span></a></li>'}else{plateDairyHtml+='<li class="dairyPortion"><a href="javascript:dropPortion('+plateIndex+", '"+plate.type+"', "+portionId+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk"';if(slateTorf){plateDairyHtml+=' style="color:'+chalkColor+'"'}plateDairyHtml+='>'+portion.name+'</span></a></li>'}}}}function updateSlate(offset){var thresholdOffset=offset+slateOffsetThreshold;if(typeof(slates[thresholdOffset])!=='undefined'){var slate=slates[thresholdOffset];addToSlate(slate)}}function populateSlate(){view=new PageView(wrap)}function compareTimes(a,b){return a.time-b.time}function updatePlate(offset,type){var slate=slates[offset];var slateId=slate.id;var typePortions;var plateId;if(type=="Breakfast"){plateId=slate.breakfastId;typePortions=slate.breakfastPortions}else if(type=="Lunch"){plateId=slate.lunchId;typePortions=slate.lunchPortions}else if(type=="Dinner"){plateId=slate.dinnerId;typePortions=slate.dinnerPortions}var plate=plates[plateId];if(portions.length>0){var fruits=new Array();var grains=new Array();var vegetables=new Array();var protein=new Array();var dairy=new Array();for(var i=0;i<portions.length;i++){if(typeof(portions[i])==='undefined')continue;var portion=portions[i];if(portion==null)continue;var portionType=portion.type;if(portionType=='Fruits')fruits.push(portion);else if(portionType=='Grain')grains.push(portion);else if(portionType=='Vegetables')vegetables.push(portion);else if(portionType=='Protein')protein.push(portion);else if(portionType=='Dairy')dairy.push(portion)}var html='';var fruitOffset=0;var grainOffset=0;var vegetableOffset=0;var proteinOffset=0;var dairyOffset=0;var portion;$("#plateEditDialog").empty();for(var i=1;i<=7;i++){html+='<div class="flexbox-holder-row'+i+'">';switch(i){case 1:portion=fruits[fruitOffset++];html+='<div class="flex" type="fruit"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=fruits[fruitOffset++];html+='<div class="flex" type="fruit"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=fruits[fruitOffset++];html+='<div class="flex" type="fruit"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';break;case 2:portion=fruits[fruitOffset++];html+='<div class="flex" type="fruit"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=fruits[fruitOffset++];html+='<div class="flex" type="fruit"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=fruits[fruitOffset++];html+='<div class="flex" type="fruit"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';break;case 3:portion=fruits[fruitOffset++];html+='<div class="flex" type="fruit"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=fruits[fruitOffset++];html+='<div class="flex" type="fruit"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=fruits[fruitOffset++];html+='<div class="flex" type="fruit"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=grains[grainOffset++];html+='<div class="flex" type="grains"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';break;case 4:portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=fruits[fruitOffset++];html+='<div class="flex" type="fruit"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=dairy[dairyOffset++];html+='<div class="flex" type="dairy"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=dairy[dairyOffset++];html+='<div class="flex" type="dairy"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=dairy[dairyOffset++];html+='<div class="flex" type="dairy"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';break;case 5:portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=dairy[dairyOffset++];html+='<div class="flex" type="dairy"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=protein[proteinOffset++];html+='<div class="flex" type="protein"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=protein[proteinOffset++];html+='<div class="flex" type="protein"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';break;case 6:portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=protein[proteinOffset++];html+='<div class="flex" type="protein"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=protein[proteinOffset++];html+='<div class="flex" type="protein"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=protein[proteinOffset++];html+='<div class="flex" type="protein"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';break;case 7:portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=vegetables[vegetableOffset++];html+='<div class="flex" type="vegetables"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=protein[proteinOffset++];html+='<div class="flex" type="protein"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';portion=protein[proteinOffset++];html+='<div class="flex" type="protein"><input name="'+portion.name+'" type="checkbox" '+getChecked(slateId,plate,portion.id,typePortions)+' value="'+portion.id+'">'+portion.name+'</input></div>';html+='<div class="flex" type="none">Save To:<button id="overridePortions" type="button">Plate</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button id="savePortions" type="submit">Slate</button></div>';break}html+='</div>'}$('#plateEditDialog').append($(html));markCheckedPortions();$("input[type='checkbox']").click(function(){var checked=$(this).get(0).checked;if(checked){$(this).parent().css('background-color','white')}else{var type=$(this).parent().attr("type");var color='mediumpurple';if(type=='fruit')color='crimson';else if(type=='grains')color='sandybrown';else if(type=='vegetables')color='mediumseagreen';else if(type=='dairy')color='cornflowerblue';$(this).parent().css('background-color',color)}$('#savePortions').attr('disabled','');$('#overridePortions').attr('disabled','')});$('#savePortions').click(function(){processPlateEdit(slateId,plate,typePortions,false)});$('#overridePortions').click(function(){processPlateEdit(slateId,plate,typePortions,true)})}var titleString=plate.name+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";$("#plateEditDialog").dialog("option","title",titleString);$("#plateEditDialog").dialog("open")}function processPlateEdit(slateId,plate,typePortions,override){if(override){plate.portion1=0;plate.portion2=0;plate.portion3=0;plate.portion4=0;plate.portion5=0;plate.portion6=0;plate.portion7=0;plate.portion8=0;plate.portion9=0}if(typeof(typePortions!=='undefined')){if(typePortions.length>0){typePortions.length=0}}var portionsChecked=$("#plateEditDialog input:checked");var len=portionsChecked.length;var portion;for(var i=0;i<len;i++){var inputElm=portionsChecked[i];portion=inputElm.value;if(typeof(typePortions!=='undefined')){typePortions.push(portion)}if(override){switch(i){case 0:plate.portion1=portion;break;case 1:plate.portion2=portion;break;case 2:plate.portion3=portion;break;case 3:plate.portion4=portion;break;case 4:plate.portion5=portion;break;case 5:plate.portion6=portion;break;case 6:plate.portion7=portion;break;case 7:plate.portion8=portion;break;case 8:plate.portion9=portion;break;default:break}}updateFood(slateId,plate.type,portion,0,0)}deactivateFoodComplement(slateId,plate.type,typePortions);if(override){var id=plate.id;plates[id]=plate;addToPlate(plate)}$("#plateEditDialog").dialog("close");view.sendEvent()}function getChecked(slateId,plate,id,typePortions){var checked='';if(typeof(typePortions!=='undefined')){if(typePortions.length>0){for(var i=0;i<typePortions.length;i++){if(typePortions[i]==id){checked='checked="checked"';break}}return checked}}systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, slate, type, portion, master, isInactive FROM food where slate=? and type=? and portion=?;',[slateId,plate.type,id],function(transaction,result){if(result.rows.length>0){var row=result.rows.item(0);isInactive=parseInt(row.id);if(isInactive==1){return checked}else{checked='checked="checked"';return checked}}else{if(plate.portion1==id||plate.portion2==id||plate.portion3==id||plate.portion4==id||plate.portion5==id||plate.portion6==id||plate.portion7==id||plate.portion8==id||plate.portion9==id){checked='checked="checked"'}return checked}})})}function markCheckedPortions(){var portionsChecked=$("#plateEditDialog input:checked");var len=portionsChecked.length;for(var i=0;i<len;i++){var inputElm=portionsChecked[i];$(inputElm).parent().css('background-color','white')}}function addToFood(slate){var id=0;systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, slate, type, portion, master, isInactive FROM food where slate=?;',[slate.id],function(transaction,result){if(result.rows.length>0){var breakfastPortions=new Array();var lunchPortions=new Array();var dinnerPortions=new Array();for(var i=0;i<result.rows.length;i++){var row=result.rows.item(i);var type=row.type;var portion=row.portion;if(type=="Breakfast"){breakfastPortions.push(portion)}else if(type=="Lunch"){lunchPortions.push(portion)}else if(type=="Dinner"){dinnerPortions.push(portion)}}slate.breakfastPortions=breakfastPortions.slice(0);slate.lunchPortions=lunchPortions.slice(0);slate.dinnerPortions=dinnerPortions.slice(0)}else{var plateId=slate.breakfastId;var plate=plates[plateId];insertFood(slate,plate);plateId=slate.lunchId;plate=plates[plateId];insertFood(slate,plate);plateId=slate.dinnerId;plate=plates[plateId];insertFood(slate,plate)}})})}function appendFood(loadSlatesCallback,count,length,slate){if(slate.id==0){alert("plateslate appendFood slate id is zero!")}systemDB.transaction(function(transaction){var id=0;transaction.executeSql('SELECT id, slate, type, portion, master, isInactive FROM food where slate=?;',[slate.id],function(transaction,result){if(result.rows.length>0){if(slate.breakfastPortions.length>0)slate.breakfastPortions.length=0;if(slate.lunchPortions.length>0)slate.lunchPortions.length=0;if(slate.dinnerPortions.length>0)slate.dinnerPortions.length=0;for(var i=0;i<result.rows.length;i++){var row=result.rows.item(i);var isInactive=row.isInactive;if(isInactive>0)continue;var type=row.type;var portion=row.portion;if(type=="Breakfast"){slate.breakfastPortions.push(portion)}else if(type=="Lunch"){slate.lunchPortions.push(portion)}else if(type=="Dinner"){slate.dinnerPortions.push(portion)}}if(length-count==1){loadSlatesCallback(true)}}else{var torf=false;if(length-count==1)torf=true;insertSlateFoods(loadSlatesCallback,torf,slate)}})})}function insertFood(slate,plate){var foods=new Array();var portionId=plate.portion1;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion2;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion3;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion4;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion5;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion6;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion7;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion8;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion9;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertFoodPortion(slate.id,plate.type,portionId,0)}}if(plate.type=="Breakfast"){slate.breakfastPortions=foods.slice(0)}else if(plate.type=="Lunch"){slate.lunchPortions=foods.slice(0)}else if(plate.type=="Dinner"){slate.dinnerPortions=foods.slice(0)}}function insertSlateFood(loadSlatesCallback,torf,slate,plate){var foods=new Array();var portionId=plate.portion1;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion2;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion3;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion4;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion5;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion6;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion7;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion8;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion9;if(!isNaN(portionId)){if(portionId>0){foods.push(portionId);insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}if(plate.type=="Breakfast"){slate.breakfastPortions.length=0;for(var i=0;i<foods.length;i++){slate.breakfastPortions.push(foods[i])}}else if(plate.type=="Lunch"){slate.lunchPortions.length=0;for(var i=0;i<foods.length;i++){slate.lunchPortions.push(foods[i])}}else if(plate.type=="Dinner"){slate.dinnerPortions.length=0;for(var i=0;i<foods.length;i++){slate.dinnerPortions.push(foods[i])}}if(torf==true){loadSlatesCallback(true)}}function insertSlateFoods(loadSlatesCallback,torf,slate){if(slate.breakfastPortions.length>0)slate.breakfastPortions.length=0;if(slate.lunchPortions.length>0)slate.lunchPortions.length=0;if(slate.dinnerPortions.length>0)slate.dinnerPortions.length=0;var plateId;var plate;for(var i=0;i<3;i++){switch(i){case 0:plateId=slate.breakfastId;break;case 1:plateId=slate.lunchId;break;case 2:plateId=slate.dinnerId;break}plate=plates[plateId];var portionId=plate.portion1;if(!isNaN(portionId)){if(portionId>0){switch(i){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion2;if(!isNaN(portionId)){if(portionId>0){switch(i){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion3;if(!isNaN(portionId)){if(portionId>0){switch(i){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion4;if(!isNaN(portionId)){if(portionId>0){switch(i){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion5;if(!isNaN(portionId)){if(portionId>0){switch(i){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion6;if(!isNaN(portionId)){if(portionId>0){switch(i){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion7;if(!isNaN(portionId)){if(portionId>0){switch(i){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion8;if(!isNaN(portionId)){if(portionId>0){switch(i){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}portionId=plate.portion9;if(!isNaN(portionId)){if(portionId>0){switch(i){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}insertSlateFoodPortion(slate.id,plate.type,portionId,0)}}}if(torf==true){loadSlatesCallback(true)}}function insertFoodPortion(slateId,type,portionId,master){if(!isNaN(portionId)){if(portionId==0)return;if(slateId==0)return;systemDB.transaction(function(transaction){transaction.executeSql('INSERT INTO food (slate, type,  portion, master, isInactive) VALUES (?,?,?,?,?);',[slateId,type,portionId,master,0],function(){},displayerrormessage)})}}function insertSlateFoodPortion(slateId,type,portionId,master){if(!isNaN(portionId)){if(portionId==0){alert("insertSlateFoodPortion portionId is zero!");return}if(slateId==0){alert("insertSlateFoodPortion slateId is zero!");return}systemDB.transaction(function(transaction){transaction.executeSql('INSERT INTO food (slate, type,  portion, master, isInactive) VALUES (?,?,?,?,?);',[slateId,type,portionId,master,0],function(){},displayerrormessage)})}}function getFoodPortions(slate,plate){var foodPortions;if(plate.type=="Breakfast"){if(typeof(slate.breakfastPortions==='undefined')){}foodPortions=slate.breakfastPortions}else if(plate.type=="Lunch"){foodPortions=slate.lunchPortions}else if(plate.type=="Dinner"){foodPortions=slate.dinnerPortions}if(foodPortions.length>0){for(var i=0;i<foodPortions.length;i++){portionId=foodPortions[i];appendPortion(plate,portionId,0,true)}}}function deactivateFoodPortions(slateId,type){systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, slate, type, portion, master, isInactive FROM food where slate=? and type=?;',[slateId,type],function(transaction,result){if(result.rows.length>0){for(var i=0;i<result.rows.length;i++){var row=result.rows.item(i);var isInactive=parseInt(row.isInactive);if(isInactive==1){continue}else{var portion=parseInt(row.portion);makeFoodPortionInactive(slateId,type,portion)}}}else{}})})}function deactivateFoodComplement(slateId,type,typePortions){systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, slate, type, portion, master, isInactive FROM food where slate=? and type=?;',[slateId,type],function(transaction,result){if(result.rows.length>0){for(var i=0;i<result.rows.length;i++){var row=result.rows.item(i);var portion=parseInt(row.portion);var torf=false;for(var j=0;j<typePortions.length;j++){if(portion==typePortions[j]){torf=true;break}}if(torf)continue;var isInactive=parseInt(row.isInactive);if(isInactive==1){continue}else{var portion=parseInt(row.portion);makeFoodPortionInactive(slateId,type,portion)}}}else{}})})}function makeFoodPortionInactive(slateId,type,portion){systemDB.transaction(function(transaction){transaction.executeSql('Update food set isInactive = 1 where slate=? and type=? and portion=?;',[slateId,type,portion],function(transaction,result){})})}function makeFoodPortionActive(slateId,type,portion){systemDB.transaction(function(transaction){transaction.executeSql('Update food set isInactive = 0 where slate=? and type=? and portion=?;',[slateId,type,portion],function(transaction,result){})})}function refreshPortionCache(slate,type){if(slate.id==0)return;var plate;if(type=="Breakfast"){slate.breakfastPortions.length=0;refreshSlateFoodsCache(slate,0)}else if(type=="Lunch"){slate.lunchPortions.length=0;refreshSlateFoodsCache(slate,1)}else if(type=="Dinner"){slate.dinnerPortions.length=0;refreshSlateFoodsCache(slate,2)}}function refreshSlateFoodsCache(slate,typeNumber){var plateId;var plate;switch(typeNumber){case 0:plateId=slate.breakfastId;break;case 1:plateId=slate.lunchId;break;case 2:plateId=slate.dinnerId;break}plate=plates[plateId];var portionId=plate.portion1;if(!isNaN(portionId)){if(portionId>0){switch(typeNumber){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}}}portionId=plate.portion2;if(!isNaN(portionId)){if(portionId>0){switch(typeNumber){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}}}portionId=plate.portion3;if(!isNaN(portionId)){if(portionId>0){switch(typeNumber){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}}}portionId=plate.portion4;if(!isNaN(portionId)){if(portionId>0){switch(typeNumber){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}}}portionId=plate.portion5;if(!isNaN(portionId)){if(portionId>0){switch(typeNumber){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}}}portionId=plate.portion6;if(!isNaN(portionId)){if(portionId>0){switch(typeNumber){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}}}portionId=plate.portion7;if(!isNaN(portionId)){if(portionId>0){switch(typeNumber){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}}}portionId=plate.portion8;if(!isNaN(portionId)){if(portionId>0){switch(typeNumber){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}}}portionId=plate.portion9;if(!isNaN(portionId)){if(portionId>0){switch(typeNumber){case 0:slate.breakfastPortions.push(portionId);break;case 1:slate.lunchPortions.push(portionId);break;case 2:slate.dinnerPortions.push(portionId);break}}}syncSlateFoodsCache(slate,typeNumber)}function syncSlateFoodsCache(slate,typeNumber){var type;var slateId=slate.id;var typePortions;switch(typeNumber){case 0:type="Breakfast";typePortions=slate.breakfastPortions;break;case 1:type="Lunch";typePortions=slate.lunchPortions;break;case 2:type="Dinner";typePortions=slate.dinnerPortions;break}deactivateFoodComplement(slateId,type,typePortions);for(var i=0;i<typePortions.length;i++){var portion=typePortions[i];updateFood(slateId,type,portion,0,0)}}function updateFood(slateId,type,portion,master,isInactive){systemDB.transaction(function(transaction){transaction.executeSql('SELECT id, slate, type, portion, master, isInactive FROM food where slate=? and type=? and portion=?;',[slateId,type,portion],function(transaction,result){if(result.rows.length>0){var row=result.rows.item(0);var id=parseInt(row.id);systemDB.transaction(function(transaction){transaction.executeSql('update food set master=?, isInactive=? where id=?;',[master,isInactive,id],function(){},displayerrormessage)})}else{systemDB.transaction(function(transaction){transaction.executeSql('INSERT INTO food (slate, type, portion, master, isInactive) VALUES (?,?,?,?,?);',[slateId,type,portion,master,isInactive],function(){},displayerrormessage)})}})})}function copySlate(source){var target=new Slate(source.id,source.offset,source.date,source.name,source.description,source.breakfastId,source.lunchId,source.dinnerId,null,null,null,source.isInactive);if(typeof(source.breakfastPortions!=='undefined')){if(source.breakfastPortions.length>0){if(target.breakfastPortions.length>0)target.breakfastPortions.length=0;for(var i=0;i<source.breakfastPortions.length;i++){target.breakfastPortions.push(source.breakfastPortions[i])}}}if(typeof(source.lunchPortions!=='undefined')){if(source.lunchPortions.length>0){if(target.lunchPortions.length>0)target.lunchPortions.length=0;for(var i=0;i<source.lunchPortions.length;i++){target.lunchPortions.push(source.lunchPortions[i])}}}if(typeof(source.dinnerPortions!=='undefined')){if(source.dinnerPortions.length>0){if(target.dinnerPortions.length>0)target.dinnerPortions.length=0;for(var i=0;i<source.dinnerPortions.length;i++){target.dinnerPortions.push(source.dinnerPortions[i])}}}return target}function copyPortions(sourcePortions){var targetPortions=new Array();if(typeof(sourcePortions)!=='undefined'){for(var i=0;i<sourcePortions.length;i++){targetPortions.push(sourcePortions[i])}}return targetPortions}function destroySlate(slate){slate.breakfastPortions=null;slate.lunchPortions=null;slate.dinnerPortions=null;slate=null}function viewSlate(location,slate){var blen=0;var llen=0;var dlen=0;if(typeof(slate.breakfastPortions!=='undefined')){if(slate.breakfastPortions.length>0){blen=slate.breakfastPortions.length}}if(typeof(slate.lunchPortions!=='undefined')){if(slate.lunchPortions.length>0){llen=slate.lunchPortions.length}}if(typeof(slate.dinnerPortions!=='undefined')){if(slate.dinnerPortions.length>0){dlen=slate.dinnerPortions.length}}alert("plateslate viewSlate "+location+" id "+slate.id+" offset "+slate.offset+" name "+slate.name+" bid "+slate.breakfastId+" lid "+slate.lunchId+" did "+slate.dinnerId+" blen "+blen+" llen "+llen+" dlen "+dlen)}function processLoginForm(){var name=document.loginForm.name.value;var pword=document.loginForm.pword.value;$.ajax({type:"GET",url:"login4app.php",data:{"name":name,"pword":pword},success:function(msg){var tempMsg=msg;JSON.parse(tempMsg,function(key,value){if(key=='id'){loginInfo.id=value}else if(key=='userName'){loginInfo.userName=value}else if(key=='firstName'){loginInfo.firstName=value}else if(key=='lastName'){loginInfo.lastName=value}});var accountId=loginInfo.id;if(accountId>0){authenticated=true;loginAccountNumber=accountId;setLogoutButton();$("#login-dial").dialog("close")}else{alert("Login failed!")}}});return false}function doLogout(){var dataString='';$.ajax({type:"GET",url:"logout4app.php",data:dataString,success:function(msg){if(msg=="false"){authenticated=false;loginAccountNumber=0}}})}function hijaxPreferencesPage(){var newPageHtml='<div data-role="page" data-add-back-btn="true" id="preferences-page" data-title="Preferences">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='<h1>Preferences</h1>';newPageHtml+='</div>';newPageHtml+='<div data-role="content"><div class="content-primary"><div id="placeSettingContents">';newPageHtml+='<form action="">';newPageHtml+='<p>Choose Place Settings Preferences for PlateSlate WebApp!</p>';newPageHtml+='<fieldset>';newPageHtml+='<label for="suggestMethod" id="suggestMethod_label">Plates are to be suggested randomly</label>';newPageHtml+='<input type="checkbox" name="suggestMethod" id="suggestMethod" size="30" value="random" ';if(plateSelectionRandom){newPageHtml+=' checked="checked" '}newPageHtml+='/><br />';newPageHtml+='<label for="filterMethod" id="filterMethod_label">Filter plate suggestions by season</label>';newPageHtml+='<input type="checkbox" name="filterMethod" id="filterMethod" size="30" value="season" ';if(plateSelectionSeasonal){newPageHtml+=' checked="checked" '}newPageHtml+='/><br />';newPageHtml+='<label for="shareMethod" id="shareMethod_label">Share slates with server (for aggregate reports)</label>';newPageHtml+='<input type="checkbox" name="shareMethod" id="shareMethod" size="30" value="share" ';if(plateSelectionShared){newPageHtml+=' checked="checked" '}newPageHtml+='/><br />';newPageHtml+='<label for="shareDinnerOnly" id="shareMethod_label">Share ONLY DINNER slates with server</label>';newPageHtml+='<input type="checkbox" name="shareDinnerOnly" id="shareDinnerOnly" size="30" value="shareDinner" ';if(slateMealPlansForDinnerOnly){newPageHtml+=' checked="checked" '}newPageHtml+='/>';newPageHtml+='</fieldset>';newPageHtml+='<br />';newPageHtml+='<input type="button" name="placeSettingPrefSubmit" class="placeSettingPrefButton" id="placeSettingPrefSubmit_btn" value="Save Preferences"';if(authenticated){newPageHtml+='/>'}else{newPageHtml+=' disabled="disabled" />'}newPageHtml+='</form>';newPageHtml+='<br />';newPageHtml+='<br />';if(!authenticated){newPageHtml+='<p style="color: red;" >NOTE: Only Logged In Users May Alter Preferences or Edit Plates!</p>'}newPageHtml+='</div>';newPageHtml+='</div>';newPageHtml+='</div>';newPageHtml+='<script type="text/javascript"></script></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$(".placeSettingPrefButton").click(function(){plateSelectionRandom=false;plateSelectionSeasonal=false;plateSelectionShared=false;slateMealPlansForDinnerOnly=false;var prefsChecked=$("#placeSettingContents input:checked");var len=prefsChecked.length;var pref;for(var i=0;i<len;i++){var inputElm=prefsChecked[i];pref=inputElm.value;if(pref=="random"){plateSelectionRandom=true}if(pref=="season"){plateSelectionSeasonal=true}if(pref=="share"){plateSelectionShared=true}if(pref=="shareDinner"){slateMealPlansForDinnerOnly=true}}preferences.plateSelectionRandom=plateSelectionRandom;preferences.plateSelectionSeasonal=plateSelectionSeasonal;preferences.plateSelectionShared=plateSelectionShared;preferences.slateMealPlansForDinnerOnly=slateMealPlansForDinnerOnly;localStorage.setItem('preferences',JSON.stringify(preferences))});$.mobile.changePage(newPage)}function hijaxReportPage(){var newPageHtml='<div data-role="page" data-add-back-btn="true" id="report-page" data-title="Report">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='<h1>Reports</h1>';newPageHtml+='</div>';newPageHtml+='<div data-role="content">';newPageHtml+='<p>The following report shows what plates are slated to be served over the next few days.</p>';newPageHtml+='<p><a href="javascript:hijaxSlateOfPlatesPage();">Slate of Plates</a></p>';newPageHtml+='<p>Dinner is often the meal that demands both variety and detailed planning.  This report shows dinners that had been slated earlier as well as the current plans.</p>';newPageHtml+='<p><a href="javascript:hijaxDinnerSlatePage();">Dinner Slate</a></p>';newPageHtml+='<p>Before leaving home to shop for food this report may be helpful.  It shows detailed portions you will need for the dinner plates that are slated for the next few days.</p>';newPageHtml+='<p><a href="javascript:hijaxDinnerPortionsSlatePage();">Dinner Portions Slate</a></p>';newPageHtml+='<p>The Prep Cook and Chef maintain a whiteboard in the kitchen.  It shows detailed portions they need for the dinner plans over the next few days.</p>';newPageHtml+='<p><a href="javascript:hijaxKitchenPortionsWhiteboardPage();">Kitchen Portions Whiteboard</a></p>';newPageHtml+='<p>For logged in users, the PlateSlate Server provides a detailed and printable report of slated plates....</p>';newPageHtml+='<p><a href="javascript:doReport();">Get PDF PlateSlate Report</a></p>';newPageHtml+='</div><script type="text/javascript"></script></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$.mobile.changePage(newPage)}function hijaxSlateOfPlatesPage(){var thresholdOffset=slateOffsetThreshold;var chalkColors=getScreenReportHues(3);var divHeaderStyle='color:'+makeColor(chalkColors[0]);var divLabelStyle='color:'+makeColor(chalkColors[1]);var divDataStyle='color:'+makeColor(chalkColors[2]);var results=getReportGridArrays(thresholdOffset,5,false);var dows=results[0];var breakfastPlates=results[1];var lunchPlates=results[2];var dinnerPlates=results[3];var len=dows.length;if(len<2)return;var gridClass='ui-grid-';if(len<3)gridClass+='a';else if(len<4)gridClass+='b';else if(len<5)gridClass+='c';else if(len<6)gridClass+='d';var columnClass='ui-block-';var newPageHtml='<div data-role="page" data-add-back-btn="true" id="slate-of-plates-report-page" data-title="Slate of Plates">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='<h1>Slate of Plates</h1>';newPageHtml+='</div>';newPageHtml+='<div data-role="content">';newPageHtml+='<div class="'+gridClass+'" style="text-align: center;">';newPageHtml+='<div class="chalk">';newPageHtml+='<div style="'+divHeaderStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a"><strong>'+dows[i]+'</strong></div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b"><strong>'+dows[i]+'</strong></div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c"><strong>'+dows[i]+'</strong></div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d"><strong>'+dows[i]+'</strong></div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e"><strong>'+dows[i]+'</strong></div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divLabelStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a"><i>Breakfast</i></div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b"><i>Breakfast</i></div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c"><i>Breakfast</i></div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d"><i>Breakfast</i></div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e"><i>Breakfast</i></div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a">'+breakfastPlates[i].name+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b">'+breakfastPlates[i].name+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c">'+breakfastPlates[i].name+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d">'+breakfastPlates[i].name+'</div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e">'+breakfastPlates[i].name+'</div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divLabelStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a"><i>Lunch</i></div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b"><i>Lunch</i></div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c"><i>Lunch</i></div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d"><i>Lunch</i></div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e"><i>Lunch</i></div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a">'+lunchPlates[i].name+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b">'+lunchPlates[i].name+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c">'+lunchPlates[i].name+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d">'+lunchPlates[i].name+'</div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e">'+lunchPlates[i].name+'</div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divLabelStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a"><i>Dinner</i></div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b"><i>Dinner</i></div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c"><i>Dinner</i></div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d"><i>Dinner</i></div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e"><i>Dinner</i></div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a">'+dinnerPlates[i].name+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b">'+dinnerPlates[i].name+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c">'+dinnerPlates[i].name+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d">'+dinnerPlates[i].name+'</div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e">'+dinnerPlates[i].name+'</div>';break}}newPageHtml+='</div>';newPageHtml+='</div>';newPageHtml+='</div></div><script type="text/javascript"></script></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$.mobile.changePage(newPage)}function hijaxDinnerSlatePage(){var thresholdOffset=slateOffsetThreshold;var chalkColors=getScreenReportHues(2);var divHeaderStyle='color:'+makeColor(chalkColors[0]);var divDataStyle='color:'+makeColor(chalkColors[1]);var results=getReportGridArrays(thresholdOffset,15,true);var dows=results[0];var breakfastPlates=results[1];var lunchPlates=results[2];var dinnerPlates=results[3];var len=dows.length;if(len<3)return;var gridClass='ui-grid-b';var columnCase;var columnClass='ui-block-';var newPageHtml='<div data-role="page" data-add-back-btn="true" id="dinner-slate-report-page" data-title="Dinner Slate">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='<h1>Dinner Slate</h1>';newPageHtml+='</div>';newPageHtml+='<div data-role="content">';newPageHtml+='<div class="'+gridClass+'" style="text-align: center;">';newPageHtml+='<div class="chalk">';for(var i=0;i<len;i+=3){newPageHtml+='<div style="'+divHeaderStyle+';">';newPageHtml+='<div class="'+columnClass+'a"><strong>'+dows[i]+'</strong></div>';if(typeof(dows[i+1])!=='undefined'){newPageHtml+='<div class="'+columnClass+'b"><strong>'+dows[i+1]+'</strong></div>'}else{newPageHtml+='<div class="'+columnClass+'b">&nbsp;</div>'}if(typeof(dows[i+2])!=='undefined'){newPageHtml+='<div class="'+columnClass+'c"><strong>'+dows[i+2]+'</strong></div>'}else{newPageHtml+='<div class="'+columnClass+'c">&nbsp;</div>'}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';newPageHtml+='<div class="'+columnClass+'a">'+dinnerPlates[i].name+'</div>';if(typeof(dinnerPlates[i+1])!=='undefined'){newPageHtml+='<div class="'+columnClass+'b">'+dinnerPlates[i+1].name+'</div>'}else{newPageHtml+='<div class="'+columnClass+'b">&nbsp;</div>'}if(typeof(dinnerPlates[i+2])!=='undefined'){newPageHtml+='<div class="'+columnClass+'c">'+dinnerPlates[i+2].name+'</div>'}else{newPageHtml+='<div class="'+columnClass+'c">&nbsp;</div>'}newPageHtml+='</div>';newPageHtml+='<div class="'+columnClass+'a">&nbsp;</div>';newPageHtml+='<div class="'+columnClass+'b">&nbsp;</div>';newPageHtml+='<div class="'+columnClass+'c">&nbsp;</div>'}newPageHtml+='</div>';newPageHtml+='</div></div><script type="text/javascript"></script></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$.mobile.changePage(newPage)}function hijaxDinnerPortionsSlatePage(){var thresholdOffset=slateOffsetThreshold;var chalkColors=getScreenReportHues(3);var divHeaderStyle='color:'+makeColor(chalkColors[0]);var divLabelStyle='color:'+makeColor(chalkColors[1]);var divDataStyle='color:'+makeColor(chalkColors[2]);var results=getReportGridArrays(thresholdOffset,4,false);var dows=results[0];var breakfastPlates=results[1];var lunchPlates=results[2];var dinnerPlates=results[3];var dinnerPortions=results[6];var len=dows.length;if(len<2)return;var gridClass='ui-grid-';if(len<3)gridClass+='b';else if(len<4)gridClass+='c';else if(len<5)gridClass+='d';var columnClass='ui-block-';var newPageHtml='<div data-role="page" data-add-back-btn="true" id="dinner-portions-slate-report-page" data-title="Dinner Portions Slate">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='<h1>Dinner Portions Slate</h1>';newPageHtml+='</div>';newPageHtml+='<div data-role="content">';newPageHtml+='<div class="'+gridClass+'" style="text-align: center;">';newPageHtml+='<div class="chalk">';newPageHtml+='<div style="'+divHeaderStyle+';">';newPageHtml+='<div class="'+columnClass+'a">&nbsp;</div>';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'b"><strong>'+dows[i]+'</strong></div>';break;case 1:newPageHtml+='<div class="'+columnClass+'c"><strong>'+dows[i]+'</strong></div>';break;case 2:newPageHtml+='<div class="'+columnClass+'d"><strong>'+dows[i]+'</strong></div>';break;case 3:newPageHtml+='<div class="'+columnClass+'e"><strong>'+dows[i]+'</strong></div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divLabelStyle+';">';newPageHtml+='<div class="'+columnClass+'a">Dinner</div>';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'b"><strong>'+dinnerPlates[i].name+'</strong></div>';break;case 1:newPageHtml+='<div class="'+columnClass+'c"><strong>'+dinnerPlates[i].name+'</strong></div>';break;case 2:newPageHtml+='<div class="'+columnClass+'d"><strong>'+dinnerPlates[i].name+'</strong></div>';break;case 3:newPageHtml+='<div class="'+columnClass+'e"><strong>'+dinnerPlates[i].name+'</strong></div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';newPageHtml+='<div class="'+columnClass+'a"><span style="color: #dd7d22;">Grain</span></div>';for(var i=0;i<len;i++){var typePortions=dinnerPortions[i];var typePortion='&nbsp;';for(j=0;j<typePortions.length;j++){var portion=portions[typePortions[j]];if(portion.type=="Grain")typePortion+=portion.name+'&nbsp;'}switch(i){case 0:newPageHtml+='<div class="'+columnClass+'b">'+typePortion+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'c">'+typePortion+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'d">'+typePortion+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'e">'+typePortion+'</div>';break;case 4:break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';newPageHtml+='<div class="'+columnClass+'a"><span style="color: #705b9b;">Protein</span></div>';for(var i=0;i<len;i++){var typePortions=dinnerPortions[i];var typePortion='&nbsp;';for(j=0;j<typePortions.length;j++){var portion=portions[typePortions[j]];if(portion.type=="Protein")typePortion+=portion.name+'&nbsp;'}switch(i){case 0:newPageHtml+='<div class="'+columnClass+'b">'+typePortion+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'c">'+typePortion+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'d">'+typePortion+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'e">'+typePortion+'</div>';break;case 4:break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';newPageHtml+='<div class="'+columnClass+'a"><span style="color: #00b65b;">Vegetable</span></div>';for(var i=0;i<len;i++){var typePortions=dinnerPortions[i];var typePortion='&nbsp;';for(j=0;j<typePortions.length;j++){var portion=portions[typePortions[j]];if(portion.type=="Vegetables")typePortion+=portion.name+'&nbsp;'}switch(i){case 0:newPageHtml+='<div class="'+columnClass+'b">'+typePortion+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'c">'+typePortion+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'d">'+typePortion+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'e">'+typePortion+'</div>';break;case 4:break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';newPageHtml+='<div class="'+columnClass+'a"><span style="color: #dc332e;">Fruit</span></div>';for(var i=0;i<len;i++){var typePortions=dinnerPortions[i];var typePortion='&nbsp;';for(j=0;j<typePortions.length;j++){var portion=portions[typePortions[j]];if(portion.type=="Fruits")typePortion+=portion.name+'&nbsp;'}switch(i){case 0:newPageHtml+='<div class="'+columnClass+'b">'+typePortion+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'c">'+typePortion+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'d">'+typePortion+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'e">'+typePortion+'</div>';break;case 4:break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';newPageHtml+='<div class="'+columnClass+'a"><span style="color: #4c98d0;">Dairy</span></div>';for(var i=0;i<len;i++){var typePortions=dinnerPortions[i];var typePortion='&nbsp;';for(j=0;j<typePortions.length;j++){var portion=portions[typePortions[j]];if(portion.type=="Dairy")typePortion+=portion.name+'&nbsp;'}switch(i){case 0:newPageHtml+='<div class="'+columnClass+'b">'+typePortion+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'c">'+typePortion+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'d">'+typePortion+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'e">'+typePortion+'</div>';break;case 4:break}}newPageHtml+='</div>';newPageHtml+='</div>';newPageHtml+='</div></div><script type="text/javascript"></script></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$.mobile.changePage(newPage)}function hijaxKitchenPortionsWhiteboardPage(){var thresholdOffset=slateOffsetThreshold;var chalkColors=getScreenReportHues(3);var divHeaderStyle='color:'+makeColor(chalkColors[0]);var divLabelStyle='color:'+makeColor(chalkColors[1]);var divDataStyle='color:'+makeColor(chalkColors[2]);var results=getReportGridArrays(thresholdOffset,5,false);var dows=results[0];var breakfastPlates=results[1];var lunchPlates=results[2];var dinnerPlates=results[3];var breakfastPortions=results[4];var lunchPortions=results[5];var dinnerPortions=results[6];var len=dows.length;if(len<2)return;var gridClass='ui-grid-';if(len<3)gridClass+='a';else if(len<4)gridClass+='b';else if(len<5)gridClass+='c';else if(len<6)gridClass+='d';var columnClass='ui-block-';var newPageHtml='<div data-role="page" data-add-back-btn="true" id="kitchen-portions-whiteboard-report-page" data-title="Kitchen Portions Whiteboard">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='<h1>Kitchen Portions Whiteboard</h1>';newPageHtml+='</div>';newPageHtml+='<div data-role="content">';newPageHtml+='<div class="'+gridClass+'" style="text-align: center;">';newPageHtml+='<div class="felt">';newPageHtml+='<div style="'+divHeaderStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a"><strong>'+dows[i]+'</strong></div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b"><strong>'+dows[i]+'</strong></div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c"><strong>'+dows[i]+'</strong></div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d"><strong>'+dows[i]+'</strong></div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e"><strong>'+dows[i]+'</strong></div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divLabelStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a"><i>Breakfast</i></div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b"><i>Breakfast</i></div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c"><i>Breakfast</i></div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d"><i>Breakfast</i></div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e"><i>Breakfast</i></div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a">'+breakfastPlates[i].name+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b">'+breakfastPlates[i].name+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c">'+breakfastPlates[i].name+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d">'+breakfastPlates[i].name+'</div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e">'+breakfastPlates[i].name+'</div>';break}}newPageHtml+='</div>';for(var i=0;i<len;i++){var typePortions=breakfastPortions[i];var typePortion='&nbsp;';for(j=0;j<typePortions.length;j++){var portion=portions[typePortions[j]];if(portion.type=="Grain"){typePortion+='<span style="color: #dd7d22;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Protein"){typePortion+='<span style="color: #705b9b;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Vegetables"){typePortion+='<span style="color: #00b65b;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Fruits"){typePortion+='<span style="color: #dc332e;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Dairy"){typePortion+='<span style="color: #4c98d0;">'+portion.name+'</span>&nbsp;'}}switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a">'+typePortion+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b">'+typePortion+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c">'+typePortion+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d">'+typePortion+'</div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e">'+typePortion+'</div>';break}}newPageHtml+='<div style="'+divLabelStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a"><i>Lunch</i></div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b"><i>Lunch</i></div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c"><i>Lunch</i></div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d"><i>Lunch</i></div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e"><i>Lunch</i></div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a">'+lunchPlates[i].name+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b">'+lunchPlates[i].name+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c">'+lunchPlates[i].name+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d">'+lunchPlates[i].name+'</div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e">'+lunchPlates[i].name+'</div>';break}}newPageHtml+='</div>';for(var i=0;i<len;i++){var typePortions=lunchPortions[i];var typePortion='&nbsp;';for(j=0;j<typePortions.length;j++){var portion=portions[typePortions[j]];if(portion.type=="Grain"){typePortion+='<span style="color: #dd7d22;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Protein"){typePortion+='<span style="color: #705b9b;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Vegetables"){typePortion+='<span style="color: #00b65b;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Fruits"){typePortion+='<span style="color: #dc332e;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Dairy"){typePortion+='<span style="color: #4c98d0;">'+portion.name+'</span>&nbsp;'}}switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a">'+typePortion+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b">'+typePortion+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c">'+typePortion+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d">'+typePortion+'</div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e">'+typePortion+'</div>';break}}newPageHtml+='<div style="'+divLabelStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a"><i>Dinner</i></div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b"><i>Dinner</i></div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c"><i>Dinner</i></div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d"><i>Dinner</i></div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e"><i>Dinner</i></div>';break}}newPageHtml+='</div>';newPageHtml+='<div style="'+divDataStyle+';">';for(var i=0;i<len;i++){switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a">'+dinnerPlates[i].name+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b">'+dinnerPlates[i].name+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c">'+dinnerPlates[i].name+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d">'+dinnerPlates[i].name+'</div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e">'+dinnerPlates[i].name+'</div>';break}}newPageHtml+='</div>';for(var i=0;i<len;i++){var typePortions=dinnerPortions[i];var typePortion='&nbsp;';for(j=0;j<typePortions.length;j++){var portion=portions[typePortions[j]];if(portion.type=="Grain"){typePortion+='<span style="color: #dd7d22;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Protein"){typePortion+='<span style="color: #705b9b;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Vegetables"){typePortion+='<span style="color: #00b65b;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Fruits"){typePortion+='<span style="color: #dc332e;">'+portion.name+'</span>&nbsp;'}else if(portion.type=="Dairy"){typePortion+='<span style="color: #4c98d0;">'+portion.name+'</span>&nbsp;'}}switch(i){case 0:newPageHtml+='<div class="'+columnClass+'a">'+typePortion+'</div>';break;case 1:newPageHtml+='<div class="'+columnClass+'b">'+typePortion+'</div>';break;case 2:newPageHtml+='<div class="'+columnClass+'c">'+typePortion+'</div>';break;case 3:newPageHtml+='<div class="'+columnClass+'d">'+typePortion+'</div>';break;case 4:newPageHtml+='<div class="'+columnClass+'e">'+typePortion+'</div>';break}}newPageHtml+='</div>';newPageHtml+='</div></div><script type="text/javascript"></script></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$.mobile.changePage(newPage)}function doReport(){if(!authenticated){alert("You must login before using this feature!");return}var thresholdOffset=slateOffsetThreshold;var xml=getReportXml('Meal Plan Report',thresholdOffset);$.post("../plateslate/storeSlates.php",{xml:xml},function(msg){var len=msg.length;var crop=len-4;var path=new String(msg);path=path.substring(0,crop);var url='../plateslate/slates2FPDF.php?xml='+path;var patt1=/slate.......xml/gi;windowName=msg.match(patt1);window.open(url,windowName,'resizable,scrollbars')})}function getReportXml(name,offset){var cursor=offset;var slate;var count=0;var maxCount=7;var xml='<slates accountId="'+loginInfo.id+'" userName="'+loginInfo.userName+'" firstName="'+loginInfo.firstName+'" lastName="'+loginInfo.lastName+'" share="'+plateSelectionShared+'">';while(count<maxCount){if(typeof(slates[cursor])==='undefined'){break}else{slate=slates[cursor++];count++;xml+=getXml(slate)}}cursor=offset-1;while(count<maxCount){if(typeof(slates[cursor])==='undefined'){break}else{slate=slates[cursor--];count++;xml+=getXml(slate)}}xml+='</slates>';return xml}function getXml(slate){var xml='<slate name="'+slate.name+'" dow="'+slate.description+'" id="'+slate.id+'"><plates>';var plateId=slate.breakfastId;var plate=plates[plateId];var portionId;var portion;var portionsLen;portionsLen=slate.breakfastPortions.length;xml+='<plate name="'+plate.name+'" type="Breakfast" description="'+plate.description+'"><portions>';for(var i=0;i<portionsLen;i++){portionId=slate.breakfastPortions[i];portion=portions[portionId];xml+='<portion type="'+portion.type+'">'+portion.name+'</portion>'}plateId=slate.lunchId;plate=plates[plateId];xml+='</portions></plate><plate name="'+plate.name+'" type="Lunch" description="'+plate.description+'"><portions>';portionsLen=slate.lunchPortions.length;for(var i=0;i<portionsLen;i++){portionId=slate.lunchPortions[i];portion=portions[portionId];xml+='<portion type="'+portion.type+'">'+portion.name+'</portion>'}plateId=slate.dinnerId;plate=plates[plateId];xml+='</portions></plate><plate name="'+plate.name+'" type="Dinner" description="'+plate.description+'"><portions>';portionsLen=slate.dinnerPortions.length;for(var i=0;i<portionsLen;i++){portionId=slate.dinnerPortions[i];portion=portions[portionId];xml+='<portion type="'+portion.type+'">'+portion.name+'</portion>'}xml+='</portions></plate></plates></slate>';return xml}function getReportGridArrays(thresholdOffset,plateCount,plateHistory){var cursor=thresholdOffset;var slate;var count=0;var maxCount=plateCount;var dow;var dows=new Array();var breakfastPlates=new Array();var lunchPlates=new Array();var dinnerPlates=new Array();var breakfastPortions=new Array();var lunchPortions=new Array();var dinnerPortions=new Array();var plateId;var plate;while(count<maxCount){if(typeof(slates[cursor])==='undefined'){break}else{slate=slates[cursor++];dow=getRelativeSlateDescription(slate);if(dow!=null){dows.push(dow)}else{dows.push(slate.description)}plateId=slate.breakfastId;plate=plates[plateId];breakfastPlates.push(plate);plateId=slate.lunchId;plate=plates[plateId];lunchPlates.push(plate);plateId=slate.dinnerId;plate=plates[plateId];dinnerPlates.push(plate);breakfastPortions.push(copyPortions(slate.breakfastPortions));lunchPortions.push(copyPortions(slate.lunchPortions));dinnerPortions.push(copyPortions(slate.dinnerPortions));count++}}cursor=thresholdOffset-1;if(count<maxCount){if(!plateHistory)maxCount=count+1;while(count<maxCount){if(typeof(slates[cursor])==='undefined'){break}else{slate=slates[cursor--];count++;dow=getRelativeSlateDescription(slate);if(dow!=null){dows.unshift(dow)}else{dows.unshift("Prior Day")}plateId=slate.breakfastId;plate=plates[plateId];breakfastPlates.unshift(plate);plateId=slate.lunchId;plate=plates[plateId];lunchPlates.unshift(plate);plateId=slate.dinnerId;plate=plates[plateId];dinnerPlates.unshift(plate);breakfastPortions.unshift(copyPortions(slate.breakfastPortions));lunchPortions.unshift(copyPortions(slate.lunchPortions));dinnerPortions.unshift(copyPortions(slate.dinnerPortions))}}}var results=new Array();results.push(dows);results.push(breakfastPlates);results.push(lunchPlates);results.push(dinnerPlates);results.push(breakfastPortions);results.push(lunchPortions);results.push(dinnerPortions);return results}function loadPreferences(){var tempPreferences=JSON.parse(localStorage.getItem('preferences'));if(typeof(tempPreferences!=='undefined')&&tempPreferences!=null){preferences.plateSelectionRandom=tempPreferences.plateSelectionRandom;preferences.plateSelectionSeasonal=tempPreferences.plateSelectionSeasonal;preferences.plateSelectionShared=tempPreferences.plateSelectionShared;preferences.slateMealPlansForDinnerOnly=tempPreferences.slateMealPlansForDinnerOnly;plateSelectionRandom=preferences.plateSelectionRandom;plateSelectionSeasonal=preferences.plateSelectionSeasonal;plateSelectionShared=preferences.plateSelectionShared;slateMealPlansForDinnerOnly=preferences.slateMealPlansForDinnerOnly}}function openSlatePlansPage(){if(slateMealPlansForDinnerOnly){hijaxDinnerPage()}else{hijaxBreakfastPage()}}function hijaxBreakfastPage(direction){var transition='slide';var reverse=false;if(direction!=null){if(direction=='reverse')reverse=true;else transition=direction}var offset=color/20;var mealName="Breakfast";var mealHtml=getSlateView(offset,mealName);var newPageHtml='<div data-role="page" id="breakfast-page" data-title="Breakfast" class="type-interior" data-theme="b" data-dom-cache="false">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='<h1>Breakfast</h1>';newPageHtml+='</div><div data-role="content"><div class="content-primary">';newPageHtml+=mealHtml;newPageHtml+='</div></div>';newPageHtml+='<div data-role="footer" data-id="foo1" data-position="fixed"><div data-role="navbar"><ul>';newPageHtml+='<li><a href="javascript:previousBreakfast();">Prev</a></li>';newPageHtml+='<li><a href="javascript:hijaxBreakfastPage();" class="ui-btn-active ui-state-persist">Breakfast</a></li>';newPageHtml+='<li><a href="javascript:hijaxLunchPage('+"'slideup'"+');">Lunch</a></li>';newPageHtml+='<li><a href="javascript:hijaxDinnerPage('+"'slideup'"+');">Dinner</a></li>';newPageHtml+='<li><a href="javascript:nextBreakfast();">Next</a></li>';newPageHtml+='</ul></div><!-- /navbar --></div><!-- /footer --></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$.mobile.changePage(newPage,{transition:transition,reverse:reverse})}function hijaxLunchPage(direction){var transition='slide';var reverse=false;if(direction!=null){if(direction=='reverse')reverse=true;else transition=direction}var offset=color/20;var mealName="Lunch";var mealHtml=getSlateView(offset,mealName);var newPageHtml='<div data-role="page" id="lunch-page" data-title="Lunch" class="type-interior" data-theme="b" data-dom-cache="true">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<h1>Lunch</h1>';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='</div><div data-role="content"><div class="content-primary">';newPageHtml+=mealHtml;newPageHtml+='</div></div>';newPageHtml+='<div data-role="footer" data-id="foo1" data-position="fixed"><div data-role="navbar"><ul>';newPageHtml+='<li><a href="javascript:previousLunch();">Prev</a></li>';newPageHtml+='<li><a href="javascript:hijaxBreakfastPage('+"'slidedown'"+');">Breakfast</a></li>';newPageHtml+='<li><a href="javascript:hijaxLunchPage();" class="ui-btn-active ui-state-persist">Lunch</a></li>';newPageHtml+='<li><a href="javascript:hijaxDinnerPage('+"'slideup'"+');">Dinner</a></li>';newPageHtml+='<li><a href="javascript:nextLunch();">Next</a></li>';newPageHtml+='</ul></div><!-- /navbar --></div><!-- /footer --></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$.mobile.changePage(newPage,{transition:transition,reverse:reverse})}function hijaxDinnerPage(direction){var transition='slide';var reverse=false;if(direction!=null){if(direction=='reverse')reverse=true;else transition=direction}var offset=color/20;var mealName="Dinner";var mealHtml=getSlateView(offset,mealName);var newPageHtml='<div data-role="page" id="dinner-page" data-title="Dinner" class="type-interior" data-theme="b" data-dom-cache="true">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<h1>Dinner</h1>';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='</div><div data-role="content"><div class="content-primary">';newPageHtml+=mealHtml;newPageHtml+='</div></div>';newPageHtml+='<div data-role="footer" data-id="foo1" data-position="fixed"><div data-role="navbar"><ul>';newPageHtml+='<li><a href="javascript:previousDinner();">Prev</a></li>';newPageHtml+='<li><a href="javascript:hijaxBreakfastPage('+"'slidedown'"+');">Breakfast</a></li>';newPageHtml+='<li><a href="javascript:hijaxLunchPage('+"'slidedown'"+');">Lunch</a></li>';newPageHtml+='<li><a href="javascript:hijaxDinnerPage();" class="ui-btn-active ui-state-persist">Dinner</a></li>';newPageHtml+='<li><a href="javascript:nextDinner();">Next</a></li>';newPageHtml+='</ul></div><!-- /navbar --></div><!-- /footer --></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$.mobile.changePage(newPage,{transition:transition,reverse:reverse})}function previousBreakfast(){color-=20;hijaxBreakfastPage('reverse')}function nextBreakfast(){color+=20;hijaxBreakfastPage()}function previousLunch(){color-=20;hijaxLunchPage('reverse')}function nextLunch(){color+=20;hijaxLunchPage()}function previousDinner(){color-=20;hijaxDinnerPage('reverse')}function nextDinner(){color+=20;hijaxDinnerPage()}function processAddNewPortionForm(portionType){var offset;var mealName;var portionSelection;if(portionType=="grain"){offset=Number(document.newGrainPortionForm.slateOffset.value);mealName=document.newGrainPortionForm.mealName.value;portionSelection=document.newGrainPortionForm.portionSelection}else if(portionType=="protein"){offset=Number(document.newProteinPortionForm.slateOffset.value);mealName=document.newProteinPortionForm.mealName.value;portionSelection=document.newProteinPortionForm.portionSelection}else if(portionType=="vegetables"){offset=Number(document.newVegetablesPortionForm.slateOffset.value);mealName=document.newVegetablesPortionForm.mealName.value;portionSelection=document.newVegetablesPortionForm.portionSelection}else if(portionType=="fruits"){offset=Number(document.newFruitsPortionForm.slateOffset.value);mealName=document.newFruitsPortionForm.mealName.value;portionSelection=document.newFruitsPortionForm.portionSelection}else if(portionType=="dairy"){offset=Number(document.newDairyPortionForm.slateOffset.value);mealName=document.newDairyPortionForm.mealName.value;portionSelection=document.newDairyPortionForm.portionSelection}var optionValue=portionSelection.options[portionSelection.selectedIndex].value;if(offset<1000){var thresholdOffset=offset+slateOffsetThreshold;var slate=slates[thresholdOffset];var slateId=slate.id;updateFood(slateId,mealName,optionValue,0,0)}else{var index=offset-1000;var dish=plates[index];var existingPortions=new Array();if(dish.portion1!=null&&dish.portion1>0)existingPortions.push(dish.portion1);if(dish.portion2!=null&&dish.portion2>0)existingPortions.push(dish.portion2);if(dish.portion3!=null&&dish.portion3>0)existingPortions.push(dish.portion3);if(dish.portion4!=null&&dish.portion4>0)existingPortions.push(dish.portion4);if(dish.portion5!=null&&dish.portion5>0)existingPortions.push(dish.portion5);if(dish.portion6!=null&&dish.portion6>0)existingPortions.push(dish.portion6);if(dish.portion7!=null&&dish.portion7>0)existingPortions.push(dish.portion7);if(dish.portion8!=null&&dish.portion8>0)existingPortions.push(dish.portion8);if(dish.portion9!=null&&dish.portion9>0)existingPortions.push(dish.portion9);var okToAdd=true;var count=0;for(var i=0;i<existingPortions.length;i++){if(existingPortions[i]==optionValue){okToAdd=false;break}count++}if(okToAdd&&count<9){count++;switch(count){case 1:dish.portion1=optionValue;break;case 2:dish.portion2=optionValue;break;case 3:dish.portion3=optionValue;break;case 4:dish.portion4=optionValue;break;case 5:dish.portion5=optionValue;break;case 6:dish.portion6=optionValue;break;case 7:dish.portion7=optionValue;break;case 8:dish.portion8=optionValue;break;case 9:dish.portion9=optionValue;break}addToPlate(dish)}}var chalkColor=0;var portionName;var newPortionHtml;var partialNewPortionHtml;if(offset<1000){chalkColor=makeColor(color);portionName=portions[optionValue].name;partialNewPortionHtml='<a href="javascript:dropPortion(0 , '+"'"+mealName+"'"+', '+optionValue+');" data-role="button" data-icon="delete" data-iconpos="right" data-theme="a"><span class="chalk" style="color:'+chalkColor+'">'+portionName+'</span></a>';aHref='href="javascript:dropPortion(0 , '+"'"+mealName+"'"+', '+optionValue+');"';spanStyle='color:'+chalkColor}if(portionType=="grain"){$('#grain-portion-dial').dialog('close');if(offset<1000){var dividerId='#grain'+mealName;if(mealName=="Breakfast"){newPortionHtml='<li  class="grainPortion">'+partialNewPortionHtml;$(dividerId).after($('<li/>',{'class':"grainPortion"}).append($('<a/>',{'href':aHref,'data-role':'button','data-icon':'delete','data-theme':'a'}).append($('<span/>',{'class':'chalk','style':spanStyle}).append($(portionName)))))}else if(mealName=="Lunch"){$('#lunch-page ul').listview('refresh')}else if(mealName=="Dinner"){$('#dinner-page ul').listview('refresh')}}}else if(portionType=="protein"){$('#protein-portion-dial').dialog('close')}else if(portionType=="vegetables"){$('#vegetables-portion-dial').dialog('close')}else if(portionType=="fruits"){$('#fruits-portion-dial').dialog('close')}else if(portionType=="dairy"){$('#dairy-portion-dial').dialog('close')}}function cancelAddNewPortionForm(portionType){var offset;var mealName;if(portionType=="grain"){$('#grain-portion-dial').dialog('close')}else if(portionType=="protein"){$('#protein-portion-dial').dialog('close')}else if(portionType=="vegetables"){$('#vegetables-portion-dial').dialog('close')}else if(portionType=="fruits"){$('#fruits-portion-dial').dialog('close')}else if(portionType=="dairy"){$('#dairy-portion-dial').dialog('close')}}function derivePortionSelectionLists(slateTorf){grainPortionSelectListHtml='<select name="portionSelection" class="Grain"><optgroup label="Grain">';proteinPortionSelectListHtml='<select name="portionSelection" class="Protein"><optgroup label="Protein">';vegetablesPortionSelectListHtml='<select name="portionSelection" class="Vegetables"><optgroup label="Vegetables">';fruitsPortionSelectListHtml='<select name="portionSelection" class="Fruits"><optgroup label="Fruits">';dairyPortionSelectListHtml='<select name="portionSelection" class="Dairy"><optgroup label="Dairy">';var len=portions.length;if(len>0){for(var i=0;i<len;i++){var currentPortion=portions[i];if(currentPortion!=null){if(currentPortion.type=="Grain"){grainPortionSelectListHtml+='<option value ="'+currentPortion.id+'">'+currentPortion.name+'</option>'}else if(currentPortion.type=="Protein"){proteinPortionSelectListHtml+='<option value ="'+currentPortion.id+'">'+currentPortion.name+'</option>'}else if(currentPortion.type=="Vegetables"){vegetablesPortionSelectListHtml+='<option value ="'+currentPortion.id+'">'+currentPortion.name+'</option>'}else if(currentPortion.type=="Fruits"){fruitsPortionSelectListHtml+='<option value ="'+currentPortion.id+'">'+currentPortion.name+'</option>'}else if(currentPortion.type=="Dairy"){dairyPortionSelectListHtml+='<option value ="'+currentPortion.id+'">'+currentPortion.name+'</option>'}}}grainPortionSelectListHtml+='</optgroup></select>';proteinPortionSelectListHtml+='</optgroup></select>';vegetablesPortionSelectListHtml+='</optgroup></select>';fruitsPortionSelectListHtml+='</optgroup></select>';dairyPortionSelectListHtml+='</optgroup></select>'}}function processAddNewPortion(offset,mealName,portionType,optionValue){var slate;var slateId;if(offset<1000){var thresholdOffset=offset+slateOffsetThreshold;slate=slates[thresholdOffset];slateId=slate.id;updateFood(slateId,mealName,optionValue,0,0)}else{var index=offset-1000;var dish=plates[index];var existingPortions=new Array();if(dish.portion1!=null&&dish.portion1>0)existingPortions.push(dish.portion1);if(dish.portion2!=null&&dish.portion2>0)existingPortions.push(dish.portion2);if(dish.portion3!=null&&dish.portion3>0)existingPortions.push(dish.portion3);if(dish.portion4!=null&&dish.portion4>0)existingPortions.push(dish.portion4);if(dish.portion5!=null&&dish.portion5>0)existingPortions.push(dish.portion5);if(dish.portion6!=null&&dish.portion6>0)existingPortions.push(dish.portion6);if(dish.portion7!=null&&dish.portion7>0)existingPortions.push(dish.portion7);if(dish.portion8!=null&&dish.portion8>0)existingPortions.push(dish.portion8);if(dish.portion9!=null&&dish.portion9>0)existingPortions.push(dish.portion9);var okToAdd=true;var count=0;for(var i=0;i<existingPortions.length;i++){if(existingPortions[i]==optionValue){okToAdd=false;break}count++}if(okToAdd&&count<9){count++;switch(count){case 1:dish.portion1=optionValue;break;case 2:dish.portion2=optionValue;break;case 3:dish.portion3=optionValue;break;case 4:dish.portion4=optionValue;break;case 5:dish.portion5=optionValue;break;case 6:dish.portion6=optionValue;break;case 7:dish.portion7=optionValue;break;case 8:dish.portion8=optionValue;break;case 9:dish.portion9=optionValue;break}addToPlate(dish)}}if(offset<1000){refreshSlatePortionCache(slate,mealName,optionValue)}}function refreshSlatePortionCache(slate,mealName,optionValue){var typePortions;if(mealName=="Breakfast"){typePortions=slate.breakfastPortions}else if(mealName=="Lunch"){typePortions=slate.lunchPortions}else if(mealName=="Dinner"){typePortions=slate.dinnerPortions}var index=0;var portionExists=false;for(var i=0;i<typePortions.length;i++){if(typePortions[i]==optionValue){portionExists=true;break}index++}if(!portionExists){if(mealName=="Breakfast"){slate.breakfastPortions[index]=optionValue;hijaxBreakfastPage('fade')}else if(mealName=="Lunch"){slate.lunchPortions[index]=optionValue;hijaxLunchPage('fade')}else if(mealName=="Dinner"){slate.dinnerPortions[index]=optionValue;hijaxDinnerPage('fade')}}}function hijaxGrainSelectionDial(offset,mealName){var newDialHtml='<div data-role="dialog" id="grain-portion-dial" data-rel="dialog"><div data-role="header">';newDialHtml+='<h1>Add New Grain Portion</h1></div>';newDialHtml+='<div data-role="content" data-theme="c">';newDialHtml+='<form name="newGrainPortionForm"><input type="hidden" name="slateOffset" /><input type="hidden" name="portionName" />';newDialHtml+='<p>Add New Grain Portion...</p><p/>';newDialHtml+='<p><label for="mealName">Meal:</label><input type="text" name="mealName" id="name" readonly="readonly" data-theme="d"/></p>';newDialHtml+='<p><label for="name">Grain:</label>'+grainPortionSelectListHtml+'</p>';newDialHtml+='</form><br><br><a href="javascript:cancelAddNewPortionForm('+"'grain'"+');" data-role="button" data-inline="true" data-theme="a">Cancel</a>';newDialHtml+='<a href="javascript:processAddNewPortionForm('+"'grain'"+');" data-role="button" data-inline="true">Add New Portion</a>';newDialHtml+='</div><script></script></div>';var newDial=$(newDialHtml);newDial.appendTo($.mobile.pageContainer);document.newGrainPortionForm.slateOffset.value=offset;document.newGrainPortionForm.mealName.value=mealName;$.mobile.changePage(newDial)}function hijaxProteinSelectionDial(offset,mealName){var newDialHtml='<div data-role="dialog" id="protein-portion-dial"><div data-role="header">';newDialHtml+='<h1>Add New Protein Portion</h1></div>';newDialHtml+='<div data-role="content" data-theme="c">';newDialHtml+='<form name="newProteinPortionForm"><input type="hidden" name="slateOffset" /><input type="hidden" name="portionName" />';newDialHtml+='<p>Add New Protein Portion...</p><p/>';newDialHtml+='<p><label for="mealName">Meal:</label><input type="text" name="mealName" id="name" readonly="readonly" data-theme="d"/></p>';newDialHtml+='<p><label for="name">Protein:</label>'+proteinPortionSelectListHtml+'</p>';newDialHtml+='</form><br><br><a href="javascript:cancelAddNewPortionForm('+"'protein'"+');" data-role="button" data-inline="true" data-theme="a">Cancel</a>';newDialHtml+='<a href="javascript:processAddNewPortionForm('+"'protein'"+');" data-role="button" data-inline="true">Add New Portion</a>';newDialHtml+='</div><script></script></div>';var newDial=$(newDialHtml);newDial.appendTo($.mobile.pageContainer);document.newProteinPortionForm.slateOffset.value=offset;document.newProteinPortionForm.mealName.value=mealName;$.mobile.changePage(newDial)}function hijaxVegetablesSelectionDial(offset,mealName){var newDialHtml='<div data-role="dialog" id="vegetables-portion-dial"><div data-role="header">';newDialHtml+='<h1>Add New Vegetable Portion</h1></div>';newDialHtml+='<div data-role="content" data-theme="c">';newDialHtml+='<form name="newVegetablesPortionForm"><input type="hidden" name="slateOffset" /><input type="hidden" name="portionName" />';newDialHtml+='<p>Add New Vegetable Portion...</p><p/>';newDialHtml+='<p><label for="mealName">Meal:</label><input type="text" name="mealName" id="name" readonly="readonly" data-theme="d"/></p>';newDialHtml+='<p><label for="name">Vegetable:</label>'+vegetablesPortionSelectListHtml+'</p>';newDialHtml+='</form><br><br><a href="javascript:cancelAddNewPortionForm('+"'vegetables'"+');" data-role="button" data-inline="true" data-theme="a">Cancel</a>';newDialHtml+='<a href="javascript:processAddNewPortionForm('+"'vegetables'"+');" data-role="button" data-inline="true">Add New Portion</a>';newDialHtml+='</div><script></script></div>';var newDial=$(newDialHtml);newDial.appendTo($.mobile.pageContainer);document.newVegetablesPortionForm.slateOffset.value=offset;document.newVegetablesPortionForm.mealName.value=mealName;$.mobile.changePage(newDial)}function hijaxFruitsSelectionDial(offset,mealName){var newDialHtml='<div data-role="dialog" id="fruits-portion-dial"><div data-role="header">';newDialHtml+='<h1>Add New Fruit Portion</h1></div>';newDialHtml+='<div data-role="content" data-theme="c">';newDialHtml+='<form name="newFruitsPortionForm"><input type="hidden" name="slateOffset" /><input type="hidden" name="portionName" />';newDialHtml+='<p>Add New Fruit Portion...</p><p/>';newDialHtml+='<p><label for="mealName">Meal:</label><input type="text" name="mealName" id="name" readonly="readonly" data-theme="d"/></p>';newDialHtml+='<p><label for="name">Fruit:</label>'+fruitsPortionSelectListHtml+'</p>';newDialHtml+='</form><br><br><a href="javascript:cancelAddNewPortionForm('+"'fruits'"+');" data-role="button" data-inline="true" data-theme="a">Cancel</a>';newDialHtml+='<a href="javascript:processAddNewPortionForm('+"'fruits'"+');" data-role="button" data-inline="true">Add New Portion</a>';newDialHtml+='</div><script></script></div>';var newDial=$(newDialHtml);newDial.appendTo($.mobile.pageContainer);document.newFruitsPortionForm.slateOffset.value=offset;document.newFruitsPortionForm.mealName.value=mealName;$.mobile.changePage(newDial)}function hijaxDairySelectionDial(offset,mealName){var newDialHtml='<div data-role="dialog" id="dairy-portion-dial"><div data-role="header">';newDialHtml+='<h1>Add New Dairy Portion</h1></div>';newDialHtml+='<div data-role="content" data-theme="c">';newDialHtml+='<form name="newDairyPortionForm"><input type="hidden" name="slateOffset" /><input type="hidden" name="portionName" />';newDialHtml+='<p>Add New Dairy Portion...</p><p/>';newDialHtml+='<p><label for="mealName">Meal:</label><input type="text" name="mealName" id="name" readonly="readonly" data-theme="d"/></p>';newDialHtml+='<p><label for="name">Dairy:</label>'+dairyPortionSelectListHtml+'</p>';newDialHtml+='</form><br><br><a href="javascript:cancelAddNewPortionForm('+"'dairy'"+');" data-role="button" data-inline="true" data-theme="a">Cancel</a>';newDialHtml+='<a href="javascript:processAddNewPortionForm('+"'dairy'"+');" data-role="button" data-inline="true">Add New Portion</a>';newDialHtml+='</div><script></script></div>';var newDial=$(newDialHtml);newDial.appendTo($.mobile.pageContainer);document.newDairyPortionForm.slateOffset.value=offset;document.newDairyPortionForm.mealName.value=mealName;$.mobile.changePage(newDial)}function dropPortion(plateIndex,mealName,portionId){if(plateIndex==0){var offset=color/20;var thresholdOffset=offset+slateOffsetThreshold;var slate=slates[thresholdOffset];var slateId=slate.id;updateFood(slateId,mealName,portionId,0,1)}else{var dish=plates[plateIndex];if(dish.portion1==portionId)dish.portion1=0;else if(dish.portion2==portionId)dish.portion2=0;else if(dish.portion3==portionId)dish.portion3=0;else if(dish.portion4==portionId)dish.portion4=0;else if(dish.portion5==portionId)dish.portion5=0;else if(dish.portion6==portionId)dish.portion6=0;else if(dish.portion7==portionId)dish.portion7=0;else if(dish.portion8==portionId)dish.portion8=0;else if(dish.portion9==portionId)dish.portion9=0;addToPlate(dish);$('#edit-plate-dial').dialog('close')}}function hijaxPlatesPage(){if(!authenticated){alert("You must login before using this feature!");return}var newPageHtml='<div data-role="page" id="plates-page" data-title="Plates" class="type-interior" data-theme="b" data-dom-cache="true">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='<h1>Plates</h1>';newPageHtml+='</div>';newPageHtml+='<div data-role="content">';newPageHtml+='<div class="content-primary">';newPageHtml+='<ul data-role="listview" id="plates-list" data-filter="true" data-filter-placeholder="Search..." data-split-icon="delete" data-split-theme="d">';for(var i=0;i<plates.length;i++){if(typeof(plates[i])!=='undefined'){var plate=plates[i];var plateName=plate.name;newPageHtml+='<li><a href="javascript:editPlate('+i+')">'+plateName+'</a><a href="javascript:inactivatePlate('+i+')" data-role="button">Remove Plate</a></li>'}}newPageHtml+="</ul>";newPageHtml+='</div>';newPageHtml+='<div class="content-secondary">';newPageHtml+='<ul data-role="listview" id="add-plates-list" data-filter="false" data-split-icon="add" data-split-theme="d">';newPageHtml+='<li><a href="javascript:addPlate()">Add New Plate</a><a href="javascript:activatePlate()" data-role="button">Add Plate</a></li>';newPageHtml+="</ul>";newPageHtml+='</div>';newPageHtml+='</div></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$.mobile.changePage(newPage)}function addPlate(){$.mobile.changePage("#add-plate-dial")}function activatePlate(){alert("plateSlateCellApp activatePlate...")}function editPlate(index){var indexOffset=1000+index;var plate=plates[index];var mealName=plate.type;derivePortionSelectionLists(false);plateGrainsHtml='<li/>';plateProteinHtml='<li/>';plateVegetablesHtml='<li/>';plateFruitsHtml='<li/>';plateDairyHtml='<li/>';if(plate.portion1!=null)appendPortion(plate,plate.portion1,index,false);if(plate.portion2!=null)appendPortion(plate,plate.portion2,index,false);if(plate.portion3!=null)appendPortion(plate,plate.portion3,index,false);if(plate.portion4!=null)appendPortion(plate,plate.portion4,index,false);if(plate.portion5!=null)appendPortion(plate,plate.portion5,index,false);if(plate.portion6!=null)appendPortion(plate,plate.portion6,index,false);if(plate.portion7!=null)appendPortion(plate,plate.portion7,index,false);if(plate.portion8!=null)appendPortion(plate,plate.portion8,index,false);if(plate.portion9!=null)appendPortion(plate,plate.portion9,index,false);var newDialHtml='<div data-role="dialog" id="edit-plate-dial"><div data-role="header">';newDialHtml+='<h1>Edit Plate</h1></div>';newDialHtml+='<div data-role="content" data-theme="c">';newDialHtml+='<li data-role="list-divider" data-theme="b"><div data-type="horizontal">';newDialHtml+='<a href="javascript:hijaxGrainSelectionDial('+indexOffset+",'"+mealName+"'"+');" data-role="button" data-icon="plus" data-inline="true" data-iconpos="right">Grains</a>';newDialHtml+='</div></li>';newDialHtml+=plateGrainsHtml;newDialHtml+='<li data-role="list-divider" data-theme="b"><div data-type="horizontal">';newDialHtml+='<a href="javascript:hijaxProteinSelectionDial('+indexOffset+",'"+mealName+"'"+');" data-role="button" data-icon="plus" data-inline="true" data-iconpos="right">Protein</a>';newDialHtml+='</div></li>';newDialHtml+=plateProteinHtml;newDialHtml+='<li data-role="list-divider" data-theme="b"><div data-type="horizontal">';newDialHtml+='<a href="javascript:hijaxVegetablesSelectionDial('+indexOffset+",'"+mealName+"'"+');" data-role="button" data-icon="plus" data-inline="true" data-iconpos="right">Vegetables</a>';newDialHtml+='</div></li>';newDialHtml+=plateVegetablesHtml;newDialHtml+='<li data-role="list-divider" data-theme="b"><div data-type="horizontal">';newDialHtml+='<a href="javascript:hijaxFruitsSelectionDial('+indexOffset+",'"+mealName+"'"+');" data-role="button" data-icon="plus" data-inline="true" data-iconpos="right">Fruits</a>';newDialHtml+='</div></li>';newDialHtml+=plateFruitsHtml;newDialHtml+='<li data-role="list-divider" data-theme="b"><div data-type="horizontal">';newDialHtml+='<a href="javascript:hijaxDairySelectionDial('+indexOffset+",'"+mealName+"'"+');" data-role="button" data-icon="plus" data-inline="true" data-iconpos="right">Dairy</a>';newDialHtml+='</div></li>';newDialHtml+=plateDairyHtml;newDialHtml+='</div><script></script></div>';var newDial=$(newDialHtml);newDial.appendTo($.mobile.pageContainer);$.mobile.changePage(newDial)}function inactivatePlate(index){alert("plateSlateCellApp inactivatePlate index "+index)}function processAddPlateForm(){var plateName;var plateDescription;var typeSelection;plateName=document.addPlateForm.name.value;plateDescription=document.addPlateForm.description.value;typeSelection=document.addPlateForm.type;var optionValue=typeSelection.options[typeSelection.selectedIndex].value;var dish;var plateExists=false;var i=plates.length;for(var j=1;j<i;j++){dish=plates[j];if(dish.name==plateName){plateExists=true;break}}if(!plateExists){var index=i++;dish=new Plate(index,optionValue,plateName,plateDescription,0,null,null,null,null,null,null,null,null,null,0);addToPlate(dish);plates[index]=dish;editPlate(index)}else{var msg="The plate with name "+plateName+" already Exists!";alert(msg);$('#add-plate-dial').dialog('close')}}function hijaxPortionsPage(){if(!authenticated){alert("You must login before using this feature!");return}var newPageHtml='<div data-role="page" id="portions-page" data-title="Portions" class="type-interior" data-theme="b" data-dom-cache="true">';newPageHtml+='<div data-role="header" data-theme="f" data-position="fixed">';newPageHtml+='<a href="index.html" data-icon="home" data-iconpos="notext" data-direction="reverse" class="ui-btn-left jqm-home">Home</a>';newPageHtml+='<h1>Portions</h1>';newPageHtml+='</div>';newPageHtml+='<div data-role="content">';newPageHtml+='<div class="content-primary">';newPageHtml+='<ul data-role="listview" id="portions-list" data-filter="true" data-filter-placeholder="Search..." data-split-icon="delete" data-split-theme="d">';for(var i=0;i<portions.length;i++){if(typeof(portions[i])!=='undefined'){var portion=portions[i];var portionName=portion.name;newPageHtml+='<li><a href="javascript:editPortion('+i+')">'+portionName+'</a><a href="javascript:inactivatePortion('+i+')" data-role="button">Remove Portion</a></li>'}}newPageHtml+="</ul>";newPageHtml+='</div>';newPageHtml+='<div class="content-secondary">';newPageHtml+='<ul data-role="listview" id="add-portions-list" data-filter="false" data-split-icon="add" data-split-theme="d">';newPageHtml+='<li><a href="javascript:addPortion()">Add New Portion</a><a href="javascript:activatePortion()" data-role="button">Add Portion</a></li>';newPageHtml+="</ul>";newPageHtml+='</div>';newPageHtml+='</div></div>';var newPage=$(newPageHtml);newPage.appendTo($.mobile.pageContainer);$.mobile.changePage(newPage)}function addPortion(){$.mobile.changePage("#add-portion-dial")}function activatePortion(){alert("plateSlateCellApp activatePortion...")}function editPortion(index){var portion=portions[index];var portionName=portion.name;var portionDescription=portion.description;var portionType=portion.type;var newDialHtml='<div data-role="dialog" id="edit-portion-dial"><div data-role="header">';newDialHtml+='<h1>Edit Portion</h1></div>';newDialHtml+='<div data-role="content" data-theme="c">';newDialHtml+='<form name="editPortionForm"><input type="hidden" name="index" value="'+index+'"/>';newDialHtml+='<p>Edit Portion...</p>';newDialHtml+='<p/><p>	<label for="name">Portion Name:</label>';newDialHtml+='<input type="text" name="name" id="portionname" value="'+portionName+'" placeholder="portionname" data-theme="d"/></p>';newDialHtml+='<p><label for="description">Description:</label>';newDialHtml+='<input type="text" name="description" id="portiondescription" value="'+portionDescription+'" placeholder="description" data-theme="d"/></p>';newDialHtml+='<p><select name="type"><optgroup label="Type">';newDialHtml+='<option value ="Grain"';if(portionType=="Grain"){newDialHtml+='selected="selected"'}newDialHtml+='>Grain</option>';newDialHtml+='<option value ="Protein"';if(portionType=="Protein"){newDialHtml+='selected="selected"'}newDialHtml+='>Protein</option>';newDialHtml+='<option value ="Vegetables"';if(portionType=="Vegetables"){newDialHtml+='selected="selected"'}newDialHtml+='>Vegetables</option>';newDialHtml+='<option value ="Fruits"';if(portionType=="Fruits"){newDialHtml+='selected="selected"'}newDialHtml+='>Fruits</option>';newDialHtml+='<option value ="Dairy"';if(portionType=="Dairy"){newDialHtml+='selected="selected"'}newDialHtml+='>Dairy</option>';newDialHtml+='</optgroup></select></p>';newDialHtml+='</form>';newDialHtml+='<br><br>';newDialHtml+='<a href="#home-page" data-role="button" data-inline="true" data-rel="back" data-theme="a">Cancel</a>';newDialHtml+='<a href="javascript:processEditPortionForm();" data-role="button" data-inline="true">Save Portion Edit</a>';newDialHtml+='<div id ="resultLog"></div>';newDialHtml+='</div><script></script></div>';var newDial=$(newDialHtml);newDial.appendTo($.mobile.pageContainer);$.mobile.changePage(newDial)}function inactivatePortion(index){alert("plateSlateCellApp inactivatePortion index "+index)}function processAddPortionForm(){var portionName;var portionDescription;var typeSelection;portionName=document.addPortionForm.name.value;portionDescription=document.addPortionForm.description.value;typeSelection=document.addPortionForm.type;var optionValue=typeSelection.options[typeSelection.selectedIndex].value;var portion;var portionExists=false;var i=portions.length;for(var j=1;j<i;j++){portion=portions[j];if(portion.name==portionName){portionExists=true;break}}if(!portionExists){var index=i++;portion=new Portion(index,optionValue,portionName,portionDescription,0,0);portions[index]=portion;addToPortion(portion);$('#add-portion-dial').dialog('close')}else{var msg="The portion with name "+portionName+" already Exists!";alert(msg);$('#add-portion-dial').dialog('close')}}function processEditPortionForm(){var portionName;var portionDescription;var typeSelection;var index=document.editPortionForm.index.value;portionName=document.editPortionForm.name.value;portionDescription=document.editPortionForm.description.value;typeSelection=document.editPortionForm.type;var optionValue=typeSelection.options[typeSelection.selectedIndex].value;var portion=portions[index];portion.name=portionName;portion.description=portionDescription;portion.type=optionValue;addToPortion(portion);$('#edit-portion-dial').dialog('close')}function makeColor(hue){return"hsl("+hue+", 100%, 50%)"}function makeRandomScreenReportColor(){var selectedOption=Math.floor(Math.random()*(screenReportFontColors.length-1));return makeColor(selectedOption)}function getScreenReportHues(len){var screenReportHues=new Array(len);var selectedIndex=Math.floor(Math.random()*(screenReportFontColors.length-1));var selectedOption=screenReportFontColors[selectedIndex];for(var i=0;i<len;i++){screenReportHues[i]=selectedOption;selectedOption+=40}return screenReportHues}function getRelativeSlateDescription(slate){var relativeSlateDescription=null;var dayMillies=24*60*60*1000;var today=new Date();today.setHours(0,0,0,0);var todayMillis=today.getTime();var date=slate.date;var relativeDateName=date.toLocaleString();relativeDate=new Date(relativeDateName);var relativeDateMillis=relativeDate.getTime();if(todayMillis==relativeDateMillis){relativeSlateDescription="Today"}else if(relativeDateMillis-todayMillis==dayMillies){relativeSlateDescription="Tomorrow"}else if(todayMillis-relativeDateMillis==dayMillies){relativeSlateDescription="Yesterday"}else if(relativeDateMillis-todayMillis>0){relativeSlateDescription=slate.description}else{relativeSlateDescription=slate.name}return relativeSlateDescription}